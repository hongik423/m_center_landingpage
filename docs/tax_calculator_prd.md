# ì„¸ë¬´ì‚¬ ì „ìš© í†µí•© ì„¸ê¸ˆê³„ì‚°ê¸° ê°œë°œ PRD

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

### í”„ë¡œì íŠ¸ ì •ë³´
- **í”„ë¡œì íŠ¸ëª…**: TaxPro Calculator
- **ë²„ì „**: 1.0.0
- **ê°œë°œ ê¸°ê°„**: 8ì£¼ (56ì¼)
- **ê°œë°œ ì¸ì›**: Frontend 2ëª…, QA 1ëª…
- **ê¸°ìˆ  ìŠ¤íƒ**: React 18, TypeScript, Ant Design, Vite

### ëª©í‘œ
ì„¸ë¬´ì‚¬ê°€ í´ë¼ì´ì–¸íŠ¸ ìƒë‹´ ì‹œ ì¦‰ì‹œ í™œìš©í•  ìˆ˜ ìˆëŠ” ì˜¬ì¸ì› ì„¸ê¸ˆê³„ì‚°ê¸° ì›¹ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ

---

## ğŸ¯ ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

### í•µì‹¬ ê¸°ëŠ¥ ëª©ë¡

#### 1. ê°œì¸ì„¸ê¸ˆ ê³„ì‚°ê¸°
- ê·¼ë¡œì†Œë“ì„¸ ê³„ì‚°ê¸°
- ì¢…í•©ì†Œë“ì„¸ ê³„ì‚°ê¸°  
- ì–‘ë„ì†Œë“ì„¸ ê³„ì‚°ê¸°
- ìƒì†ì„¸ ê³„ì‚°ê¸°
- ì¦ì—¬ì„¸ ê³„ì‚°ê¸°

#### 2. ë²•ì¸ì„¸ê¸ˆ ê³„ì‚°ê¸°
- ë²•ì¸ì„¸ ê³„ì‚°ê¸°
- ë¶€ê°€ê°€ì¹˜ì„¸ ê³„ì‚°ê¸°
- ì›ì²œì§•ìˆ˜ì„¸ ê³„ì‚°ê¸°

#### 3. ê³µí†µ ê¸°ëŠ¥
- ê³„ì‚° ê²°ê³¼ íˆìŠ¤í† ë¦¬ ê´€ë¦¬
- ê²°ê³¼ ì¸ì‡„/ë³µì‚¬ ê¸°ëŠ¥
- ë¹ ë¥¸ê³„ì‚° ë°”ë¡œê°€ê¸°
- ì‹¤ì‹œê°„ ì…ë ¥ ê²€ì¦

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React Application                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Components  â”‚  Hooks  â”‚  Utils  â”‚  Types  â”‚  Constants â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Tax Calculation Engine                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Local Storage                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í´ë” êµ¬ì¡°
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”‚   â”‚   â””â”€â”€ MainLayout.tsx
â”‚   â”‚   â”œâ”€â”€ Forms/
â”‚   â”‚   â”‚   â”œâ”€â”€ NumberInput.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PercentInput.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DatePicker.tsx
â”‚   â”‚   â”‚   â””â”€â”€ FormSection.tsx
â”‚   â”‚   â””â”€â”€ Results/
â”‚   â”‚       â”œâ”€â”€ ResultCard.tsx
â”‚   â”‚       â”œâ”€â”€ ResultTable.tsx
â”‚   â”‚       â”œâ”€â”€ CalculationBreakdown.tsx
â”‚   â”‚       â””â”€â”€ ActionButtons.tsx
â”‚   â”œâ”€â”€ calculators/
â”‚   â”‚   â”œâ”€â”€ personal/
â”‚   â”‚   â”‚   â”œâ”€â”€ EarnedIncomeTax/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EarnedIncomeTaxCalculator.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EarnedIncomeTaxForm.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ EarnedIncomeTaxResult.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ComprehensiveIncomeTax/
â”‚   â”‚   â”‚   â”œâ”€â”€ CapitalGainsTax/
â”‚   â”‚   â”‚   â”œâ”€â”€ InheritanceTax/
â”‚   â”‚   â”‚   â””â”€â”€ GiftTax/
â”‚   â”‚   â””â”€â”€ corporate/
â”‚   â”‚       â”œâ”€â”€ CorporateTax/
â”‚   â”‚       â”œâ”€â”€ VAT/
â”‚   â”‚       â””â”€â”€ WithholdingTax/
â”‚   â””â”€â”€ features/
â”‚       â”œâ”€â”€ TabNavigation.tsx
â”‚       â”œâ”€â”€ QuickCalculator.tsx
â”‚       â”œâ”€â”€ HistoryManager.tsx
â”‚       â””â”€â”€ PrintManager.tsx
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useCalculator.ts
â”‚   â”œâ”€â”€ useHistory.ts
â”‚   â”œâ”€â”€ useValidation.ts
â”‚   â””â”€â”€ usePrint.ts
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ calculations/
â”‚   â”‚   â”œâ”€â”€ personalTax.ts
â”‚   â”‚   â”œâ”€â”€ corporateTax.ts
â”‚   â”‚   â”œâ”€â”€ taxRates.ts
â”‚   â”‚   â””â”€â”€ deductions.ts
â”‚   â”œâ”€â”€ formatters.ts
â”‚   â”œâ”€â”€ validators.ts
â”‚   â””â”€â”€ storage.ts
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ calculator.types.ts
â”‚   â”œâ”€â”€ tax.types.ts
â”‚   â””â”€â”€ common.types.ts
â”œâ”€â”€ constants/
â”‚   â”œâ”€â”€ taxRates.ts
â”‚   â”œâ”€â”€ deductions.ts
â”‚   â””â”€â”€ messages.ts
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ taxTable2024.json
â”‚   â””â”€â”€ deductionRates.json
â””â”€â”€ styles/
    â”œâ”€â”€ globals.css
    â”œâ”€â”€ variables.css
    â””â”€â”€ components/
```

---

## ğŸ“± UI/UX ìƒì„¸ ì„¤ê³„

### ì „ì²´ ë ˆì´ì•„ì›ƒ ëª…ì„¸

#### ì»¨í…Œì´ë„ˆ ì‚¬ì´ì¦ˆ
- **ìµœëŒ€ ë„ˆë¹„**: 1200px
- **ìµœì†Œ ë„ˆë¹„**: 768px
- **íŒ¨ë”©**: 24px
- **ì—¬ë°±**: 16px

#### ìƒ‰ìƒ íŒ”ë ˆíŠ¸
```css
:root {
  --primary-color: #1890ff;
  --success-color: #52c41a;
  --warning-color: #faad14;
  --error-color: #ff4d4f;
  --text-color: #262626;
  --text-secondary: #8c8c8c;
  --bg-color: #ffffff;
  --bg-secondary: #fafafa;
  --border-color: #d9d9d9;
}
```

#### íƒ€ì´í¬ê·¸ë˜í”¼
```css
/* ì œëª© */
.title-large { font-size: 24px; font-weight: 600; line-height: 32px; }
.title-medium { font-size: 20px; font-weight: 500; line-height: 28px; }
.title-small { font-size: 16px; font-weight: 500; line-height: 24px; }

/* ë³¸ë¬¸ */
.body-large { font-size: 16px; font-weight: 400; line-height: 24px; }
.body-medium { font-size: 14px; font-weight: 400; line-height: 22px; }
.body-small { font-size: 12px; font-weight: 400; line-height: 20px; }

/* ê²°ê³¼ í‘œì‹œ */
.result-large { font-size: 28px; font-weight: 600; line-height: 36px; }
.result-medium { font-size: 20px; font-weight: 500; line-height: 28px; }
```

### ì»´í¬ë„ŒíŠ¸ë³„ ìƒì„¸ ëª…ì„¸

#### 1. MainLayout ì»´í¬ë„ŒíŠ¸
```typescript
interface MainLayoutProps {
  children: React.ReactNode;
}

const MainLayout: React.FC<MainLayoutProps> = ({ children }) => {
  return (
    <div className="main-layout">
      <Header />
      <main className="main-content">
        {children}
      </main>
      <Footer />
    </div>
  );
};
```

#### 2. TabNavigation ì»´í¬ë„ŒíŠ¸
```typescript
interface TabNavigationProps {
  activeTab: string;
  onTabChange: (tab: string) => void;
}

interface TabItem {
  key: string;
  label: string;
  icon?: React.ReactNode;
  children: React.ReactNode;
}

const tabs: TabItem[] = [
  {
    key: 'personal',
    label: 'ê°œì¸ì„¸ê¸ˆ',
    icon: <UserOutlined />,
    children: <PersonalTaxCalculators />
  },
  {
    key: 'corporate', 
    label: 'ë²•ì¸ì„¸ê¸ˆ',
    icon: <BankOutlined />,
    children: <CorporateTaxCalculators />
  },
  {
    key: 'quick',
    label: 'ë¹ ë¥¸ê³„ì‚°',
    icon: <ThunderboltOutlined />,
    children: <QuickCalculator />
  },
  {
    key: 'history',
    label: 'ê³„ì‚°ê¸°ë¡',
    icon: <HistoryOutlined />,
    children: <HistoryManager />
  }
];
```

#### 3. NumberInput ì»´í¬ë„ŒíŠ¸
```typescript
interface NumberInputProps {
  label: string;
  value: number | null;
  onChange: (value: number | null) => void;
  required?: boolean;
  suffix?: string;
  placeholder?: string;
  min?: number;
  max?: number;
  precision?: number;
  disabled?: boolean;
  tooltip?: string;
  error?: string;
}

const NumberInput: React.FC<NumberInputProps> = ({
  label,
  value,
  onChange,
  required = false,
  suffix = 'ì›',
  placeholder,
  min = 0,
  max,
  precision = 0,
  disabled = false,
  tooltip,
  error
}) => {
  const handleChange = (val: number | null) => {
    if (val === null || (val >= min && (!max || val <= max))) {
      onChange(val);
    }
  };

  return (
    <Form.Item
      label={
        <span>
          {label}
          {required && <span style={{ color: 'red' }}> *</span>}
          {tooltip && <Tooltip title={tooltip}><InfoCircleOutlined /></Tooltip>}
        </span>
      }
      validateStatus={error ? 'error' : ''}
      help={error}
    >
      <InputNumber
        value={value}
        onChange={handleChange}
        placeholder={placeholder}
        suffix={suffix}
        min={min}
        max={max}
        precision={precision}
        disabled={disabled}
        formatter={(value) => `${value}`.replace(/\B(?=(\d{3})+(?!\d))/g, ',')}
        parser={(value) => value!.replace(/\$\s?|(,*)/g, '')}
        style={{ width: '100%' }}
      />
    </Form.Item>
  );
};
```

---

## ğŸ§® ê³„ì‚° ì—”ì§„ ìƒì„¸ ì„¤ê³„

### ì„¸ê¸ˆ ê³„ì‚° ì¸í„°í˜ì´ìŠ¤

#### ê³µí†µ ì¸í„°í˜ì´ìŠ¤
```typescript
interface TaxCalculationInput {
  [key: string]: number | string | boolean | Date;
}

interface TaxCalculationResult {
  taxableAmount: number;        // ê³¼ì„¸í‘œì¤€
  calculatedTax: number;        // ì‚°ì¶œì„¸ì•¡  
  localIncomeTax: number;       // ì§€ë°©ì†Œë“ì„¸
  totalTax: number;             // ì´ ì„¸ì•¡
  netAmount?: number;           // ì‹¤ìˆ˜ë ¹ì•¡
  breakdown: CalculationBreakdown;
  appliedRates: AppliedRate[];
  deductions: Deduction[];
}

interface CalculationBreakdown {
  steps: CalculationStep[];
  summary: {
    totalIncome: number;
    totalDeductions: number;
    taxableIncome: number;
    taxBeforeCredits: number;
    taxCredits: number;
    finalTax: number;
  };
}

interface CalculationStep {
  label: string;
  amount: number;
  formula?: string;
  note?: string;
}

interface AppliedRate {
  range: string;
  rate: number;
  amount: number;
}

interface Deduction {
  type: string;
  label: string;
  amount: number;
  limit?: number;
}
```

#### ê·¼ë¡œì†Œë“ì„¸ ê³„ì‚°ê¸° ì¸í„°í˜ì´ìŠ¤
```typescript
interface EarnedIncomeTaxInput extends TaxCalculationInput {
  annualSalary: number;                    // ì—°ë´‰
  dependents: number;                      // ë¶€ì–‘ê°€ì¡± ìˆ˜
  pensionContribution: number;             // êµ­ë¯¼ì—°ê¸ˆ ê¸°ì—¬ê¸ˆ
  healthInsurance: number;                 // ê±´ê°•ë³´í—˜ë£Œ
  employmentInsurance: number;             // ê³ ìš©ë³´í—˜ë£Œ
  personalPensionContribution: number;     // ê°œì¸ì—°ê¸ˆ ë‚©ì…ì•¡
  housingFund: number;                     // ì£¼íƒì²­ì•½ì¢…í•©ì €ì¶•
  medicalExpenses: number;                 // ì˜ë£Œë¹„
  educationExpenses: number;               // êµìœ¡ë¹„
  donationAmount: number;                  // ê¸°ë¶€ê¸ˆ
  creditCardUsage: number;                 // ì‹ ìš©ì¹´ë“œ ì‚¬ìš©ì•¡
  isDisabled: boolean;                     // ì¥ì• ì¸ ì—¬ë¶€
  isElderly: boolean;                      // ê²½ë¡œìš°ëŒ€ ì—¬ë¶€
}

interface EarnedIncomeTaxResult extends TaxCalculationResult {
  monthlySalary: number;                   // ì›” ì‹¤ìˆ˜ë ¹ì•¡
  yearEndTaxSettlement: number;            // ì—°ë§ì •ì‚° ì˜ˆìƒì•¡
  monthlyWithholding: number;              // ì›” ì›ì²œì§•ìˆ˜ì„¸ì•¡
}
```

### ì„¸ê¸ˆ ê³„ì‚° ê³µì‹

#### 1. ê·¼ë¡œì†Œë“ì„¸ ê³„ì‚° ë¡œì§
```typescript
class EarnedIncomeTaxCalculator {
  static calculate(input: EarnedIncomeTaxInput): EarnedIncomeTaxResult {
    // 1ë‹¨ê³„: ê·¼ë¡œì†Œë“ê³µì œ ê³„ì‚°
    const earnedIncomeDeduction = this.calculateEarnedIncomeDeduction(input.annualSalary);
    
    // 2ë‹¨ê³„: ì¸ì ê³µì œ ê³„ì‚°  
    const personalDeduction = this.calculatePersonalDeduction(input);
    
    // 3ë‹¨ê³„: íŠ¹ë³„ê³µì œ/í‘œì¤€ê³µì œ ê³„ì‚°
    const specialDeduction = this.calculateSpecialDeduction(input);
    const standardDeduction = 130000; // 2024ë…„ ê¸°ì¤€
    const deduction = Math.max(specialDeduction, standardDeduction);
    
    // 4ë‹¨ê³„: ê³¼ì„¸í‘œì¤€ ê³„ì‚°
    const taxableIncome = Math.max(0, 
      input.annualSalary - earnedIncomeDeduction - personalDeduction - deduction
    );
    
    // 5ë‹¨ê³„: ì‚°ì¶œì„¸ì•¡ ê³„ì‚°
    const calculatedTax = this.calculateProgressiveTax(taxableIncome, TAX_RATES_2024);
    
    // 6ë‹¨ê³„: ì„¸ì•¡ê³µì œ ê³„ì‚°
    const taxCredit = this.calculateTaxCredit(input);
    
    // 7ë‹¨ê³„: ê²°ì •ì„¸ì•¡ ê³„ì‚°
    const finalTax = Math.max(0, calculatedTax - taxCredit);
    const localIncomeTax = Math.floor(finalTax * 0.1);
    const totalTax = finalTax + localIncomeTax;
    
    // 8ë‹¨ê³„: ì›” ì‹¤ìˆ˜ë ¹ì•¡ ê³„ì‚°
    const monthlyGross = input.annualSalary / 12;
    const monthlyTax = totalTax / 12;
    const monthlySalary = monthlyGross - monthlyTax - input.pensionContribution/12 - input.healthInsurance/12;
    
    return {
      taxableAmount: taxableIncome,
      calculatedTax: finalTax,
      localIncomeTax,
      totalTax,
      monthlySalary: Math.floor(monthlySalary),
      netAmount: input.annualSalary - totalTax,
      yearEndTaxSettlement: 0, // ë³„ë„ ê³„ì‚° í•„ìš”
      monthlyWithholding: Math.floor(monthlyTax),
      breakdown: this.generateBreakdown(input, taxableIncome, calculatedTax, finalTax),
      appliedRates: this.getAppliedRates(taxableIncome),
      deductions: this.getDeductionList(earnedIncomeDeduction, personalDeduction, deduction)
    };
  }

  private static calculateEarnedIncomeDeduction(salary: number): number {
    if (salary <= 5000000) return Math.min(salary * 0.7, 3500000);
    if (salary <= 15000000) return Math.min(3500000 + (salary - 5000000) * 0.4, 9500000);
    if (salary <= 45000000) return Math.min(9500000 + (salary - 15000000) * 0.15, 14000000);
    if (salary <= 100000000) return Math.min(14000000 + (salary - 45000000) * 0.05, 16750000);
    return 20000000;
  }

  private static calculatePersonalDeduction(input: EarnedIncomeTaxInput): number {
    let deduction = 1500000; // ë³¸ì¸ê³µì œ
    deduction += input.dependents * 1500000; // ë¶€ì–‘ê°€ì¡±ê³µì œ
    if (input.isDisabled) deduction += 2000000; // ì¥ì• ì¸ê³µì œ
    if (input.isElderly) deduction += 1000000; // ê²½ë¡œìš°ëŒ€ê³µì œ
    return deduction;
  }

  private static calculateProgressiveTax(income: number, rates: TaxRate[]): number {
    let tax = 0;
    let remainingIncome = income;
    
    for (const rate of rates) {
      if (remainingIncome <= 0) break;
      
      const bracketIncome = Math.min(remainingIncome, rate.max - rate.min);
      tax += bracketIncome * rate.rate;
      remainingIncome -= bracketIncome;
    }
    
    return Math.floor(tax);
  }
}
```

#### 2. ì„¸ìœ¨ í…Œì´ë¸” (2024ë…„ ê¸°ì¤€)
```typescript
const TAX_RATES_2024: TaxRate[] = [
  { min: 0, max: 14000000, rate: 0.06 },
  { min: 14000000, max: 50000000, rate: 0.15 },
  { min: 50000000, max: 88000000, rate: 0.24 },
  { min: 88000000, max: 150000000, rate: 0.35 },
  { min: 150000000, max: 300000000, rate: 0.38 },
  { min: 300000000, max: 500000000, rate: 0.40 },
  { min: 500000000, max: 1000000000, rate: 0.42 },
  { min: 1000000000, max: Infinity, rate: 0.45 }
];

const CORPORATE_TAX_RATES_2024: TaxRate[] = [
  { min: 0, max: 200000000, rate: 0.10 },        // ì¤‘ì†Œê¸°ì—… íŠ¹ë¡€
  { min: 200000000, max: 20000000000, rate: 0.20 },   // ì¤‘ì†Œê¸°ì—…
  { min: 20000000000, max: 300000000000, rate: 0.22 }, // ì¼ë°˜ë²•ì¸
  { min: 300000000000, max: Infinity, rate: 0.25 }     // ì¼ë°˜ë²•ì¸
];
```

#### 3. ì–‘ë„ì†Œë“ì„¸ ê³„ì‚° ë¡œì§
```typescript
class CapitalGainsTaxCalculator {
  static calculate(input: CapitalGainsTaxInput): CapitalGainsTaxResult {
    // 1ë‹¨ê³„: ì–‘ë„ì°¨ìµ ê³„ì‚°
    const capitalGain = input.transferPrice - input.acquisitionPrice - input.transferExpenses;
    
    // 2ë‹¨ê³„: ì–‘ë„ì†Œë“ê¸ˆì•¡ ê³„ì‚° (ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ ì ìš©)
    const longTermDeduction = this.calculateLongTermDeduction(capitalGain, input.holdingPeriod);
    const capitalGainIncome = capitalGain - longTermDeduction;
    
    // 3ë‹¨ê³„: ì–‘ë„ì†Œë“ê³¼ì„¸í‘œì¤€ ê³„ì‚°
    const basicDeduction = 2500000; // ê¸°ë³¸ê³µì œ
    const taxableGain = Math.max(0, capitalGainIncome - basicDeduction);
    
    // 4ë‹¨ê³„: ì„¸ìœ¨ ì ìš©
    let taxRate: number;
    if (input.isOneHousehold && input.isResidential) {
      // 1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ ë˜ëŠ” ê°ë©´
      taxRate = this.getOneHouseholdTaxRate(input.holdingPeriod);
    } else {
      taxRate = this.getGeneralCapitalGainsTaxRate(input.holdingPeriod);
    }
    
    const calculatedTax = Math.floor(taxableGain * taxRate);
    const localIncomeTax = Math.floor(calculatedTax * 0.1);
    const totalTax = calculatedTax + localIncomeTax;
    
    return {
      capitalGain,
      capitalGainIncome,
      taxableAmount: taxableGain,
      calculatedTax,
      localIncomeTax,
      totalTax,
      netProceeds: input.transferPrice - totalTax,
      breakdown: this.generateCapitalGainsBreakdown(input, capitalGain, taxableGain, calculatedTax),
      appliedRates: [{ range: `${taxRate * 100}%`, rate: taxRate, amount: calculatedTax }],
      deductions: [
        { type: 'longTerm', label: 'ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ', amount: longTermDeduction },
        { type: 'basic', label: 'ê¸°ë³¸ê³µì œ', amount: basicDeduction }
      ]
    };
  }

  private static calculateLongTermDeduction(capitalGain: number, holdingPeriod: number): number {
    if (holdingPeriod < 1) return 0;
    
    const deductionRates = [
      { years: 1, rate: 0.1 },
      { years: 2, rate: 0.12 },
      { years: 3, rate: 0.16 },
      { years: 4, rate: 0.20 },
      { years: 5, rate: 0.24 },
      { years: 6, rate: 0.28 },
      { years: 7, rate: 0.32 },
      { years: 8, rate: 0.36 },
      { years: 9, rate: 0.40 },
      { years: 10, rate: 0.44 }
    ];
    
    const rate = deductionRates.find(r => holdingPeriod >= r.years)?.rate || 0;
    return Math.floor(capitalGain * rate);
  }
}
```

---

## ğŸ”§ ìƒíƒœ ê´€ë¦¬ ì„¤ê³„

### Context API êµ¬ì¡°
```typescript
// ì „ì—­ ìƒíƒœ ê´€ë¦¬
interface AppState {
  activeTab: string;
  calculationHistory: CalculationRecord[];
  currentCalculation: CalculationState | null;
  userPreferences: UserPreferences;
}

interface CalculationState {
  type: CalculatorType;
  inputs: Record<string, any>;
  results: TaxCalculationResult | null;
  isCalculating: boolean;
  errors: Record<string, string>;
}

interface CalculationRecord {
  id: string;
  timestamp: Date;
  type: CalculatorType;
  inputs: Record<string, any>;
  results: TaxCalculationResult;
  title: string;
}

// Context Provider
const AppContext = createContext<{
  state: AppState;
  dispatch: Dispatch<AppAction>;
}>({} as any);

// Action Types
type AppAction =
  | { type: 'SET_ACTIVE_TAB'; payload: string }
  | { type: 'ADD_CALCULATION_RECORD'; payload: CalculationRecord }
  | { type: 'SET_CALCULATION_INPUTS'; payload: { type: CalculatorType; inputs: Record<string, any> } }
  | { type: 'SET_CALCULATION_RESULTS'; payload: TaxCalculationResult }
  | { type: 'SET_CALCULATION_ERROR'; payload: { field: string; error: string } }
  | { type: 'CLEAR_CALCULATION_ERRORS' }
  | { type: 'SET_CALCULATING'; payload: boolean };

// Reducer
const appReducer = (state: AppState, action: AppAction): AppState => {
  switch (action.type) {
    case 'SET_ACTIVE_TAB':
      return { ...state, activeTab: action.payload };
    
    case 'ADD_CALCULATION_RECORD':
      const newHistory = [action.payload, ...state.calculationHistory].slice(0, 50);
      return { ...state, calculationHistory: newHistory };
    
    case 'SET_CALCULATION_INPUTS':
      return {
        ...state,
        currentCalculation: {
          ...state.currentCalculation!,
          inputs: action.payload.inputs,
          type: action.payload.type
        }
      };
    
    case 'SET_CALCULATION_RESULTS':
      return {
        ...state,
        currentCalculation: {
          ...state.currentCalculation!,
          results: action.payload,
          isCalculating: false
        }
      };
    
    default:
      return state;
  }
};
```

### Custom Hooks

#### useCalculator Hook
```typescript
interface UseCalculatorReturn {
  inputs: Record<string, any>;
  results: TaxCalculationResult | null;
  errors: Record<string, string>;
  isCalculating: boolean;
  updateInput: (field: string, value: any) => void;
  calculate: () => Promise<void>;
  reset: () => void;
  saveToHistory: (title?: string) => void;
}

const useCalculator = (calculatorType: CalculatorType): UseCalculatorReturn => {
  const { state, dispatch } = useContext(AppContext);
  const currentCalc = state.currentCalculation;

  const updateInput = useCallback((field: string, value: any) => {
    const newInputs = { ...currentCalc?.inputs, [field]: value };
    dispatch({
      type: 'SET_CALCULATION_INPUTS',
      payload: { type: calculatorType, inputs: newInputs }
    });

    // ì‹¤ì‹œê°„ ìœ íš¨ì„± ê²€ì‚¬
    const error = validateInput(field, value, calculatorType);
    if (error) {
      dispatch({ type: 'SET_CALCULATION_ERROR', payload: { field, error } });
    } else {
      dispatch({ type: 'CLEAR_FIELD_ERROR', payload: field });
    }
  }, [currentCalc?.inputs, calculatorType, dispatch]);

  const calculate = useCallback(async () => {
    if (!currentCalc?.inputs) return;

    dispatch({ type: 'SET_CALCULATING', payload: true });
    dispatch({ type: 'CLEAR_CALCULATION_ERRORS' });

    try {
      // ì „ì²´ ìœ íš¨ì„± ê²€ì‚¬
      const validationErrors = validateAllInputs(currentCalc.inputs, calculatorType);
      if (Object.keys(validationErrors).length > 0) {
        Object.entries(validationErrors).forEach(([field, error]) => {
          dispatch({ type: 'SET_CALCULATION_ERROR', payload: { field, error } });
        });
        return;
      }

      // ê³„ì‚° ì‹¤í–‰
      const calculator = getCalculator(calculatorType);
      const results = await calculator.calculate(currentCalc.inputs);
      
      dispatch({ type: 'SET_CALCULATION_RESULTS', payload: results });
    } catch (error) {
      console.error('ê³„ì‚° ì˜¤ë¥˜:', error);
      dispatch({ 
        type: 'SET_CALCULATION_ERROR', 
        payload: { field: 'general', error: 'ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' }
      });
    } finally {
      dispatch({ type: 'SET_CALCULATING', payload: false });
    }
  }, [currentCalc?.inputs, calculatorType, dispatch]);

  const saveToHistory = useCallback((title?: string) => {
    if (!currentCalc?.results) return;

    const record: CalculationRecord = {
      id: generateId(),
      timestamp: new Date(),
      type: calculatorType,
      inputs: currentCalc.inputs,
      results: currentCalc.results,
      title: title || getDefaultTitle(calculatorType, currentCalc.inputs)
    };

    dispatch({ type: 'ADD_CALCULATION_RECORD', payload: record });
    
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
    saveToLocalStorage('calculationHistory', record);
  }, [currentCalc, calculatorType, dispatch]);

  return {
    inputs: currentCalc?.inputs || {},
    results: currentCalc?.results || null,
    errors: currentCalc?.errors || {},
    isCalculating: currentCalc?.isCalculating || false,
    updateInput,
    calculate,
    reset: () => dispatch({ type: 'RESET_CALCULATION', payload: calculatorType }),
    saveToHistory
  };
};
```

#### useValidation Hook
```typescript
const useValidation = (calculatorType: CalculatorType) => {
  const validateInput = useCallback((field: string, value: any): string | null => {
    const rules = getValidationRules(calculatorType, field);
    
    for (const rule of rules) {
      const error = rule.validate(value);
      if (error) return error;
    }
    
    return null;
  }, [calculatorType]);

  const validateAllInputs = useCallback((inputs: Record<string, any>): Record<string, string> => {
    const errors: Record<string, string> = {};
    const allRules = getAllValidationRules(calculatorType);
    
    Object.entries(allRules).forEach(([field, rules]) => {
      const value = inputs[field];
      for (const rule of rules) {
        const error = rule.validate(value);
        if (error) {
          errors[field] = error;
          break;
        }
      }
    });
    
    return errors;
  }, [calculatorType]);

  return { validateInput, validateAllInputs };
};
```

---

## ğŸ“Š ë°ì´í„° êµ¬ì¡° ë° ì €ì¥

### ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì„¤ê³„
```typescript
// ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í‚¤
const STORAGE_KEYS = {
  CALCULATION_HISTORY: 'taxcalc_history',
  USER_PREFERENCES: 'taxcalc_preferences',
  TAX_RATES_CACHE: 'taxcalc_rates_cache'
} as const;

// íˆìŠ¤í† ë¦¬ ê´€ë¦¬
interface StoredCalculationHistory {
  version: string;
  lastUpdated: string;
  records: CalculationRecord[];
}

class StorageManager {
  static saveCalculationRecord(record: CalculationRecord): void {
    const stored = this.getCalculationHistory();
    stored.records = [record, ...stored.records].slice(0, 50); // ìµœëŒ€ 50ê°œ
    stored.lastUpdated = new Date().toISOString();
    
    localStorage.setItem(
      STORAGE_KEYS.CALCULATION_HISTORY, 
      JSON.stringify(stored)
    );
  }

  static getCalculationHistory(): StoredCalculationHistory {
    const stored = localStorage.getItem(STORAGE_KEYS.CALCULATION_HISTORY);
    if (!stored) {
      return {
        version: '1.0.0',
        lastUpdated: new Date().toISOString(),
        records: []
      };
    }
    
    try {
      return JSON.parse(stored);
    } catch {
      return {
        version: '1.0.0',
        lastUpdated: new Date().toISOString(),
        records: []
      };
    }
  }

  static clearHistory(): void {
    localStorage.removeItem(STORAGE_KEYS.CALCULATION_HISTORY);
  }
}
```

### ì„¸ìœ¨ ë°ì´í„° êµ¬ì¡°
```typescript
// taxRates.json
{
  "version": "2024.1",
  "lastUpdated": "2024-01-01",
  "incomeTax": {
    "personal": [
      { "min": 0, "max": 14000000, "rate": 0.06, "deduction": 0 },
      { "min": 14000000, "max": 50000000, "rate": 0.15, "deduction": 1260000 },
      { "min": 50000000, "max": 88000000, "rate": 0.24, "deduction": 5760000 },
      { "min": 88000000, "max": 150000000, "rate": 0.35, "deduction": 15440000 },
      { "min": 150000000, "max": 300000000, "rate": 0.38, "deduction": 19940000 },
      { "min": 300000000, "max": 500000000, "rate": 0.40, "deduction": 25940000 },
      { "min": 500000000, "max": 1000000000, "rate": 0.42, "deduction": 35940000 },
      { "min": 1000000000, "max": null, "rate": 0.45, "deduction": 65940000 }
    ],
    "corporate": {
      "small": [
        { "min": 0, "max": 200000000, "rate": 0.10 },
        { "min": 200000000, "max": 20000000000, "rate": 0.20 }
      ],
      "general": [
        { "min": 0, "max": 300000000000, "rate": 0.22 },
        { "min": 300000000000, "max": null, "rate": 0.25 }
      ]
    }
  },
  "capitalGainsTax": {
    "residential": {
      "general": [
        { "holdingPeriod": 0, "rate": 0.06 },
        { "holdingPeriod": 1, "rate": 0.06 },
        { "holdingPeriod": 2, "rate": 0.42 }
      ],
      "oneHousehold": [
        { "holdingPeriod": 0, "rate": 0 },
        { "holdingPeriod": 2, "rate": 0 },
        { "holdingPeriod": 10, "rate": 0 }
      ]
    }
  },
  "inheritanceTax": [
    { "min": 0, "max": 100000000, "rate": 0.10, "deduction": 0 },
    { "min": 100000000, "max": 500000000, "rate": 0.20, "deduction": 10000000 },
    { "min": 500000000, "max": 1000000000, "rate": 0.30, "deduction": 60000000 },
    { "min": 1000000000, "max": 3000000000, "rate": 0.40, "deduction": 160000000 },
    { "min": 3000000000, "max": null, "rate": 0.50, "deduction": 460000000 }
  ],
  "deductions": {
    "personal": {
      "basic": 1500000,
      "spouse": 1500000,
      "dependent": 1500000,
      "disabled": 2000000,
      "elderly": 1000000
    },
    "standard": 130000,
    "earned_income": {
      "rates": [
        { "min": 0, "max": 5000000, "rate": 0.70, "max_deduction": 3500000 },
        { "min": 5000000, "max": 15000000, "rate": 0.40, "base": 3500000, "max_deduction": 9500000 },
        { "min": 15000000, "max": 45000000, "rate": 0.15, "base": 9500000, "max_deduction": 14000000 },
        { "min": 45000000, "max": 100000000, "rate": 0.05, "base": 14000000, "max_deduction": 16750000 },
        { "min": 100000000, "max": null, "rate": 0, "base": 20000000 }
      ]
    }
  }
}
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì„¤ê³„

#### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Jest + Testing Library)
```typescript
// __tests__/calculators/EarnedIncomeTax.test.ts
describe('EarnedIncomeTaxCalculator', () => {
  describe('calculate', () => {
    test('ì—°ë´‰ 5000ë§Œì›, ë¶€ì–‘ê°€ì¡± 2ëª… ê³„ì‚°', () => {
      const input: EarnedIncomeTaxInput = {
        annualSalary: 50000000,
        dependents: 2,
        pensionContribution: 2250000,
        healthInsurance: 1500000,
        employmentInsurance: 150000,
        personalPensionContribution: 0,
        housingFund: 0,
        medicalExpenses: 0,
        educationExpenses: 0,
        donationAmount: 0,
        creditCardUsage: 0,
        isDisabled: false,
        isElderly: false
      };

      const result = EarnedIncomeTaxCalculator.calculate(input);

      expect(result.taxableAmount).toBe(31500000); // ì˜ˆìƒ ê³¼ì„¸í‘œì¤€
      expect(result.calculatedTax).toBe(3990000);  // ì˜ˆìƒ ì‚°ì¶œì„¸ì•¡
      expect(result.totalTax).toBe(4389000);       // ì˜ˆìƒ ì´ì„¸ì•¡
      expect(result.monthlySalary).toBeGreaterThan(3000000); // ì›” ì‹¤ìˆ˜ë ¹ì•¡
    });

    test('ìµœì € ê³¼ì„¸í‘œì¤€ ì¼€ì´ìŠ¤', () => {
      const input: EarnedIncomeTaxInput = {
        annualSalary: 20000000,
        dependents: 0,
        // ... ê¸°íƒ€ í•„ë“œ
      };

      const result = EarnedIncomeTaxCalculator.calculate(input);
      
      expect(result.taxableAmount).toBeGreaterThanOrEqual(0);
      expect(result.calculatedTax).toBeGreaterThanOrEqual(0);
    });

    test('ê³ ì†Œë“ì ì¼€ì´ìŠ¤ (ì—°ë´‰ 5ì–µ)', () => {
      const input: EarnedIncomeTaxInput = {
        annualSalary: 500000000,
        dependents: 0,
        // ... ê¸°íƒ€ í•„ë“œ
      };

      const result = EarnedIncomeTaxCalculator.calculate(input);
      
      expect(result.calculatedTax).toBeGreaterThan(100000000); // 1ì–µ ì´ìƒ
      expect(result.totalTax).toBeGreaterThan(110000000); // ì§€ë°©ì†Œë“ì„¸ í¬í•¨
    });
  });

  describe('calculateEarnedIncomeDeduction', () => {
    test.each([
      [5000000, 3500000],      // 500ë§Œì› -> 350ë§Œì›
      [15000000, 7500000],     // 1500ë§Œì› -> 750ë§Œì›  
      [50000000, 14000000],    // 5000ë§Œì› -> 1400ë§Œì›
      [100000000, 16750000],   // 1ì–µì› -> 1675ë§Œì›
      [200000000, 20000000]    // 2ì–µì› -> 2000ë§Œì›
    ])('ì—°ë´‰ %iì›ì¼ ë•Œ ê·¼ë¡œì†Œë“ê³µì œ %iì›', (salary, expectedDeduction) => {
      const deduction = EarnedIncomeTaxCalculator.calculateEarnedIncomeDeduction(salary);
      expect(deduction).toBe(expectedDeduction);
    });
  });
});
```

#### 2. í†µí•© í…ŒìŠ¤íŠ¸
```typescript
// __tests__/integration/CalculatorWorkflow.test.tsx
describe('ê³„ì‚°ê¸° í†µí•© ì›Œí¬í”Œë¡œìš°', () => {
  test('ê·¼ë¡œì†Œë“ì„¸ ê³„ì‚° ì „ì²´ í”Œë¡œìš°', async () => {
    render(<App />);
    
    // 1. ê°œì¸ì„¸ê¸ˆ íƒ­ ì„ íƒ
    fireEvent.click(screen.getByText('ê°œì¸ì„¸ê¸ˆ'));
    
    // 2. ê·¼ë¡œì†Œë“ì„¸ ê³„ì‚°ê¸° ì„ íƒ
    fireEvent.change(screen.getByRole('combobox'), { 
      target: { value: 'earned-income-tax' } 
    });
    
    // 3. ë°ì´í„° ì…ë ¥
    await userEvent.type(screen.getByLabelText('ì—°ë´‰'), '50000000');
    await userEvent.type(screen.getByLabelText('ë¶€ì–‘ê°€ì¡± ìˆ˜'), '2');
    
    // 4. ê³„ì‚° ë²„íŠ¼ í´ë¦­ (ë˜ëŠ” ìë™ ê³„ì‚°)
    await waitFor(() => {
      expect(screen.getByText(/ê³¼ì„¸í‘œì¤€/)).toBeInTheDocument();
    });
    
    // 5. ê²°ê³¼ í™•ì¸
    expect(screen.getByText(/31,500,000ì›/)).toBeInTheDocument();
    
    // 6. íˆìŠ¤í† ë¦¬ì— ì €ì¥
    fireEvent.click(screen.getByText('ì €ì¥'));
    
    // 7. íˆìŠ¤í† ë¦¬ íƒ­ì—ì„œ í™•ì¸
    fireEvent.click(screen.getByText('ê³„ì‚°ê¸°ë¡'));
    expect(screen.getByText(/ê·¼ë¡œì†Œë“ì„¸ ê³„ì‚°/)).toBeInTheDocument();
  });
});
```

#### 3. E2E í…ŒìŠ¤íŠ¸ (Playwright)
```typescript
// e2e/calculator.spec.ts
import { test, expect } from '@playwright/test';

test.describe('ì„¸ê¸ˆ ê³„ì‚°ê¸° E2E', () => {
  test('ì „ì²´ ê³„ì‚°ê¸° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸', async ({ page }) => {
    await page.goto('http://localhost:3000');
    
    // ê·¼ë¡œì†Œë“ì„¸ ê³„ì‚°
    await page.click('text=ê°œì¸ì„¸ê¸ˆ');
    await page.selectOption('[data-testid=calculator-select]', 'earned-income-tax');
    
    await page.fill('[data-testid=annual-salary]', '50000000');
    await page.fill('[data-testid=dependents]', '2');
    
    await expect(page.locator('[data-testid=taxable-amount]')).toContainText('31,500,000');
    
    // ì¸ì‡„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
    await page.click('[data-testid=print-button]');
    // ì¸ì‡„ ë‹¤ì´ì–¼ë¡œê·¸ í™•ì¸
    
    // íˆìŠ¤í† ë¦¬ ì €ì¥ í…ŒìŠ¤íŠ¸
    await page.click('[data-testid=save-button]');
    await page.click('text=ê³„ì‚°ê¸°ë¡');
    await expect(page.locator('[data-testid=history-item]')).toBeVisible();
  });
});
```

### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
```typescript
// __tests__/performance/CalculationPerformance.test.ts
describe('ê³„ì‚° ì„±ëŠ¥ í…ŒìŠ¤íŠ¸', () => {
  test('ë³µì¡í•œ ê³„ì‚°ì˜ ì„±ëŠ¥', () => {
    const start = performance.now();
    
    // 1000ë²ˆ ê³„ì‚° ì‹¤í–‰
    for (let i = 0; i < 1000; i++) {
      EarnedIncomeTaxCalculator.calculate({
        annualSalary: Math.random() * 100000000,
        dependents: Math.floor(Math.random() * 5),
        // ... ê¸°íƒ€ ëœë¤ ê°’
      });
    }
    
    const end = performance.now();
    const duration = end - start;
    
    expect(duration).toBeLessThan(1000); // 1ì´ˆ ì´ë‚´ ì™„ë£Œ
  });

  test('ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í…ŒìŠ¤íŠ¸', () => {
    const initialMemory = performance.memory?.usedJSHeapSize || 0;
    
    // ëŒ€ëŸ‰ ê³„ì‚° ì‹¤í–‰
    for (let i = 0; i < 10000; i++) {
      EarnedIncomeTaxCalculator.calculate(sampleInput);
    }
    
    // ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ê°•ì œ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ)
    if (global.gc) global.gc();
    
    const finalMemory = performance.memory?.usedJSHeapSize || 0;
    const memoryGrowth = finalMemory - initialMemory;
    
    expect(memoryGrowth).toBeLessThan(10 * 1024 * 1024); // 10MB ì´ë‚´
  });
});
```

---

## ğŸš€ ë°°í¬ ë° ìš´ì˜

### ë¹Œë“œ ì„¤ì •

#### package.json
```json
{
  "name": "taxpro-calculator",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "test": "jest",
    "test:e2e": "playwright test",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "preview": "vite preview",
    "analyze": "vite-bundle-analyzer"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "antd": "^5.12.0",
    "big.js": "^6.2.1",
    "dayjs": "^1.11.10"
  },
  "devDependencies": {
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@typescript-eslint/eslint-plugin": "^6.14.0",
    "@vitejs/plugin-react": "^4.2.1",
    "typescript": "^5.2.2",
    "vite": "^5.0.8",
    "jest": "^29.7.0",
    "@testing-library/react": "^13.4.0",
    "@playwright/test": "^1.40.0",
    "vite-bundle-analyzer": "^0.7.0"
  }
}
```

#### vite.config.ts
```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  build: {
    target: 'es2020',
    outDir: 'dist',
    sourcemap: false,
    minify: 'terser',
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          antd: ['antd'],
          utils: ['big.js', 'dayjs']
        }
      }
    }
  },
  optimizeDeps: {
    include: ['react', 'react-dom', 'antd', 'big.js']
  }
});
```

### CI/CD íŒŒì´í”„ë¼ì¸

#### GitHub Actions (.github/workflows/deploy.yml)
```yaml
name: Build and Deploy

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run tests
        run: npm run test
      
      - name: Run E2E tests
        run: |
          npx playwright install
          npm run test:e2e
      
      - name: Upload test results
        uses: actions/upload-artifact@v3
        if: failure()
        with:
          name: test-results
          path: test-results/

  build:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build
        run: npm run build
        env:
          NODE_ENV: production
      
      - name: Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: build-files
          path: dist/

  deploy:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Download build artifacts
        uses: actions/download-artifact@v3
        with:
          name: build-files
          path: dist/
      
      - name: Deploy to S3
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_REGION: ${{ secrets.AWS_REGION }}
          S3_BUCKET: ${{ secrets.S3_BUCKET }}
        run: |
          aws s3 sync dist/ s3://$S3_BUCKET --delete
          aws cloudfront create-invalidation --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} --paths "/*"
```

### ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„

#### ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
```typescript
// src/utils/monitoring.ts
class PerformanceMonitor {
  static trackCalculationTime(calculatorType: string, duration: number) {
    // ê³„ì‚° ì‹œê°„ ì¶”ì 
    if (window.gtag) {
      window.gtag('event', 'calculation_time', {
        calculator_type: calculatorType,
        duration_ms: duration,
        event_category: 'performance'
      });
    }
  }

  static trackError(error: Error, context: string) {
    // ì—ëŸ¬ ì¶”ì 
    console.error(`Error in ${context}:`, error);
    
    if (window.gtag) {
      window.gtag('event', 'exception', {
        description: error.message,
        fatal: false,
        context
      });
    }
  }

  static trackUsage(action: string, calculatorType?: string) {
    // ì‚¬ìš© íŒ¨í„´ ì¶”ì 
    if (window.gtag) {
      window.gtag('event', action, {
        calculator_type: calculatorType,
        event_category: 'engagement'
      });
    }
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
const startTime = performance.now();
const result = await calculator.calculate(inputs);
const endTime = performance.now();

PerformanceMonitor.trackCalculationTime(
  calculatorType, 
  endTime - startTime
);
```

### ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ëª¨ë“  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] E2E í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ í†µê³¼ (ê³„ì‚° ì‹œê°„ < 1ì´ˆ)
- [ ] í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ë°˜ì‘í˜• ë””ìì¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸ ì™„ë£Œ (WCAG 2.1 AA)
- [ ] ì„¸ìœ¨ ì •ë³´ ìµœì‹  ë²„ì „ í™•ì¸
- [ ] ë³´ì•ˆ ì·¨ì•½ì  ìŠ¤ìº” ì™„ë£Œ

#### ë°°í¬ í›„ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í”„ë¡œë•ì…˜ í™˜ê²½ ë™ì‘ í™•ì¸
- [ ] ëª¨ë“  ê³„ì‚°ê¸° ì •ìƒ ë™ì‘ í™•ì¸
- [ ] ì„±ëŠ¥ ì§€í‘œ í™•ì¸ (ë¡œë”© ì‹œê°„ < 3ì´ˆ)
- [ ] ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ì„¤ì • í™•ì¸
- [ ] ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘ ì‹œìŠ¤í…œ í™œì„±í™”

---

## ğŸ“ˆ ì„±ê³µ ì§€í‘œ ë° KPI

### ê¸°ìˆ ì  KPI
- **ë¡œë”© ì‹œê°„**: ì´ˆê¸° ë¡œë”© < 3ì´ˆ, ê³„ì‚° ê²°ê³¼ < 1ì´ˆ
- **ì •í™•ë„**: êµ­ì„¸ì²­ ì˜ˆì‹œ ì¼€ì´ìŠ¤ 100% ì¼ì¹˜
- **ê°€ìš©ì„±**: 99.9% ì—…íƒ€ì„
- **ì—ëŸ¬ìœ¨**: < 0.1%

### ì‚¬ìš©ì ê²½í—˜ KPI
- **ì‘ì—… ì™„ë£Œìœ¨**: ê³„ì‚° ì‘ì—… 95% ì´ìƒ ì„±ê³µ
- **ì‚¬ìš©ì ë§Œì¡±ë„**: 4.5/5.0 ì´ìƒ
- **ì¬ì‚¬ìš©ë¥ **: ì›”ê°„ í™œì„± ì‚¬ìš©ìì˜ 80% ì´ìƒì´ ì¬ë°©ë¬¸

### ë¹„ì¦ˆë‹ˆìŠ¤ KPI
- **ë„ì…ë¥ **: íŒŒíŠ¸ë„ˆ ì„¸ë¬´ì‚¬ì˜ 70% ì´ìƒ ì‚¬ìš©
- **íš¨ìœ¨ì„±**: ê¸°ì¡´ ë°©ì‹ ëŒ€ë¹„ 30% ì‹œê°„ ë‹¨ì¶•
- **ì •í™•ì„±**: ê³„ì‚° ì˜¤ë¥˜ë¡œ ì¸í•œ ë¬¸ì˜ 90% ê°ì†Œ

---

---

## ğŸ¢ ì¶”ê°€ íŠ¹í™” ê³„ì‚°ê¸° - ê°€ì—…ìƒì† ë° ì£¼ì‹ì´ë™ ì„¸ê¸ˆ

### ì¶”ê°€ ê³„ì‚°ê¸° ê°œìš”

ê¸°ë³¸ ì„¸ê¸ˆ ê³„ì‚°ê¸° ì™¸ì— ì„¸ë¬´ì‚¬ê°€ ìì£¼ ì ‘í•˜ëŠ” íŠ¹ìˆ˜í•œ ì„¸ë¬´ ìƒí™©ì„ ìœ„í•œ ì „ë¬¸ ê³„ì‚°ê¸°ë¥¼ ì¶”ê°€ ê°œë°œí•©ë‹ˆë‹¤.

#### ì¶”ê°€ ê³„ì‚°ê¸° ëª©ë¡
1. **ê°€ì—…ìƒì†ì„¸ ê³„ì‚°ê¸°** (ìƒì†ì„¸ íŠ¹ë¡€)
2. **ì£¼ì‹ì´ë™ ì„¸ê¸ˆ í†µí•© ê³„ì‚°ê¸°**
   - ì£¼ì‹ì–‘ë„ì†Œë“ì„¸ ê³„ì‚°ê¸°
   - ì£¼ì‹ì¦ì—¬ì„¸ ê³„ì‚°ê¸°  
   - ì£¼ì‹ìƒì†ì„¸ ê³„ì‚°ê¸°
   - ì£¼ì‹ë°°ë‹¹ì†Œë“ì„¸ ê³„ì‚°ê¸°

---

## ğŸ­ ê°€ì—…ìƒì†ì„¸ ê³„ì‚°ê¸° ìƒì„¸ ì„¤ê³„

### ê¸°ëŠ¥ ê°œìš”
- ì¤‘ì†Œê¸°ì—…/ì¤‘ê²¬ê¸°ì—…ì˜ ê°€ì—…ìƒì† ì‹œ ì ìš©ë˜ëŠ” íŠ¹ë¡€ ê³µì œë¥¼ ë°˜ì˜í•œ ìƒì†ì„¸ ê³„ì‚°
- ì‚¬í›„ê´€ë¦¬ ì˜ë¬´ì‚¬í•­ ì•ˆë‚´ ë° ì„¸ì•¡ ì‹œë®¬ë ˆì´ì…˜
- ì¼ë°˜ ìƒì†ì„¸ ëŒ€ë¹„ ì ˆì„¸ íš¨ê³¼ ë¹„êµ ë¶„ì„

### ì…ë ¥ ì¸í„°í˜ì´ìŠ¤
```typescript
interface BusinessInheritanceInput extends TaxCalculationInput {
  // ê¸°ë³¸ ìƒì† ì •ë³´
  totalInheritanceValue: number;        // ì´ ìƒì†ì¬ì‚° ê°€ì•¡
  businessAssetValue: number;           // ê°€ì—…ìš© ìì‚° ê°€ì•¡
  personalAssetValue: number;           // ê°œì¸ ìì‚° ê°€ì•¡
  debtsAndExpenses: number;             // ì±„ë¬´ ë° ê³µê³¼ê¸ˆ
  
  // ê°€ì—… ì •ë³´
  businessType: 'small' | 'medium';    // ì¤‘ì†Œê¸°ì—…/ì¤‘ê²¬ê¸°ì—… êµ¬ë¶„
  businessPeriod: number;               // ì—…ë ¥ (ì—°ë‹¨ìœ„)
  employeeCount: number;                // ì¢…ì—…ì› ìˆ˜
  annualRevenue: number;                // ì—°ê°„ ë§¤ì¶œì•¡
  
  // ìƒì†ì¸ ì •ë³´
  inheritorsCount: number;              // ìƒì†ì¸ ìˆ˜
  spouseExists: boolean;                // ë°°ìš°ì ì¡´ì¬ ì—¬ë¶€
  directDescendants: number;            // ì§ê³„ë¹„ì† ìˆ˜
  relationshipToDeceased: string;       // í”¼ìƒì†ì¸ê³¼ì˜ ê´€ê³„
  
  // ì‚¬í›„ê´€ë¦¬ ê³„íš
  continuousManagement: boolean;        // ê³„ì† ê²½ì˜ ì˜ì‚¬
  employmentMaintenance: boolean;       // ê³ ìš© ìœ ì§€ ê³„íš
  businessLocationMaintenance: boolean; // ì‚¬ì—…ì¥ ì†Œì¬ì§€ ìœ ì§€
  
  // ê¸°íƒ€ ê³µì œ
  hasDisabledPerson: boolean;           // ì¥ì• ì¸ ìƒì†ì¸ ì—¬ë¶€
  hasElderlyPerson: boolean;            // 65ì„¸ ì´ìƒ ìƒì†ì¸ ì—¬ë¶€
  hasMinorChildren: boolean;            // ë¯¸ì„±ë…„ì ìƒì†ì¸ ì—¬ë¶€
}

interface BusinessInheritanceResult extends TaxCalculationResult {
  // ê°€ì—…ìƒì† íŠ¹í™” ê²°ê³¼
  businessInheritanceDeduction: number;  // ê°€ì—…ìƒì†ê³µì œì•¡
  regularInheritanceTax: number;         // ì¼ë°˜ ìƒì†ì„¸ (ë¹„êµìš©)
  taxSavingAmount: number;               // ì ˆì„¸ íš¨ê³¼
  taxSavingRate: number;                 // ì ˆì„¸ìœ¨
  
  // ì‚¬í›„ê´€ë¦¬ ì •ë³´
  managementPeriod: number;              // ì‚¬í›„ê´€ë¦¬ ê¸°ê°„ (ë…„)
  employmentMaintenanceRequired: number; // ê³ ìš©ìœ ì§€ ì˜ë¬´ ì¸ì›
  penaltyRisk: PenaltyRisk[];           // ì‚¬í›„ê´€ë¦¬ ìœ„ë°˜ ì‹œ ì¶”ì§• ìœ„í—˜
  
  // ì—°ë„ë³„ ë¶„í• ë‚©ë¶€ ê³„íš
  installmentPlan: InstallmentPlan[];   // ë¶„í• ë‚©ë¶€ ê³„íš
}

interface PenaltyRisk {
  violationType: string;                 // ìœ„ë°˜ ìœ í˜•
  penaltyRate: number;                  // ì¶”ì§• ì„¸ìœ¨
  penaltyAmount: number;                // ì˜ˆìƒ ì¶”ì§•ì„¸ì•¡
  riskLevel: 'low' | 'medium' | 'high'; // ìœ„í—˜ë„
}

interface InstallmentPlan {
  year: number;                         // ë‚©ë¶€ì—°ë„
  amount: number;                       // ë‚©ë¶€ê¸ˆì•¡
  dueDate: string;                      // ë‚©ë¶€ê¸°í•œ
  interestRate: number;                 // ì ìš© ì´ììœ¨
}
```

### ê°€ì—…ìƒì†ì„¸ ê³„ì‚° ë¡œì§
```typescript
class BusinessInheritanceCalculator {
  static calculate(input: BusinessInheritanceInput): BusinessInheritanceResult {
    // 1ë‹¨ê³„: ê¸°ë³¸ ìƒì†ì„¸ ê³„ì‚°
    const basicInheritanceResult = this.calculateBasicInheritance(input);
    
    // 2ë‹¨ê³„: ê°€ì—…ìƒì†ê³µì œ ì ê²©ì„± ê²€í† 
    const eligibilityCheck = this.checkEligibility(input);
    if (!eligibilityCheck.isEligible) {
      throw new Error(`ê°€ì—…ìƒì†ê³µì œ ìš”ê±´ ë¯¸ì¶©ì¡±: ${eligibilityCheck.reason}`);
    }
    
    // 3ë‹¨ê³„: ê°€ì—…ìƒì†ê³µì œì•¡ ê³„ì‚°
    const businessDeduction = this.calculateBusinessInheritanceDeduction(input);
    
    // 4ë‹¨ê³„: ê³µì œ ì ìš© í›„ ê³¼ì„¸í‘œì¤€ ê³„ì‚°
    const adjustedTaxableAmount = Math.max(0, 
      basicInheritanceResult.taxableAmount - businessDeduction
    );
    
    // 5ë‹¨ê³„: ìµœì¢… ìƒì†ì„¸ ê³„ì‚°
    const finalTax = this.calculateProgressiveTax(adjustedTaxableAmount, INHERITANCE_TAX_RATES);
    const localIncomeTax = Math.floor(finalTax * 0.1);
    const totalTax = finalTax + localIncomeTax;
    
    // 6ë‹¨ê³„: ì ˆì„¸ íš¨ê³¼ ê³„ì‚°
    const taxSaving = basicInheritanceResult.totalTax - totalTax;
    const taxSavingRate = (taxSaving / basicInheritanceResult.totalTax) * 100;
    
    // 7ë‹¨ê³„: ì‚¬í›„ê´€ë¦¬ ê³„íš ìˆ˜ë¦½
    const managementPlan = this.generateManagementPlan(input);
    
    // 8ë‹¨ê³„: ë¶„í• ë‚©ë¶€ ê³„íš ìˆ˜ë¦½
    const installmentPlan = this.generateInstallmentPlan(totalTax, input);
    
    return {
      taxableAmount: adjustedTaxableAmount,
      calculatedTax: finalTax,
      localIncomeTax,
      totalTax,
      businessInheritanceDeduction: businessDeduction,
      regularInheritanceTax: basicInheritanceResult.totalTax,
      taxSavingAmount: taxSaving,
      taxSavingRate: Math.round(taxSavingRate * 100) / 100,
      managementPeriod: managementPlan.period,
      employmentMaintenanceRequired: managementPlan.employmentCount,
      penaltyRisk: managementPlan.risks,
      installmentPlan,
      breakdown: this.generateBusinessInheritanceBreakdown(input, businessDeduction, finalTax),
      appliedRates: this.getAppliedRates(adjustedTaxableAmount),
      deductions: this.getBusinessDeductionList(input, businessDeduction)
    };
  }

  private static calculateBusinessInheritanceDeduction(input: BusinessInheritanceInput): number {
    // ê°€ì—…ìƒì†ê³µì œ í•œë„ ê²°ì •
    const maxDeduction = input.businessType === 'small' ? 30000000000 : 50000000000; // 300ì–µ or 500ì–µ
    
    // ì‹¤ì œ ê°€ì—…ìš© ìì‚° ê°€ì•¡ê³¼ í•œë„ ì¤‘ ì‘ì€ ê¸ˆì•¡
    const applicableAmount = Math.min(input.businessAssetValue, maxDeduction);
    
    // ì—…ë ¥ì— ë”°ë¥¸ ê³µì œìœ¨ ì ìš©
    let deductionRate = 1.0;
    if (input.businessPeriod < 3) {
      deductionRate = 0.8; // 3ë…„ ë¯¸ë§Œ: 80%
    } else if (input.businessPeriod < 7) {
      deductionRate = 0.9; // 3ë…„~7ë…„ ë¯¸ë§Œ: 90%
    }
    // 7ë…„ ì´ìƒ: 100%
    
    return Math.floor(applicableAmount * deductionRate);
  }

  private static checkEligibility(input: BusinessInheritanceInput): { isEligible: boolean; reason?: string } {
    // ì—…ë ¥ ìš”ê±´ (3ë…„ ì´ìƒ)
    if (input.businessPeriod < 3) {
      return { isEligible: false, reason: 'ì—…ë ¥ 3ë…„ ì´ìƒ ìš”ê±´ ë¯¸ì¶©ì¡±' };
    }
    
    // ìƒì†ì¸ì˜ ê²½ì˜ ì°¸ì—¬ ì˜ì‚¬
    if (!input.continuousManagement) {
      return { isEligible: false, reason: 'ê³„ì† ê²½ì˜ ì˜ì‚¬ ì—†ìŒ' };
    }
    
    // ê³ ìš© ìœ ì§€ ê³„íš
    if (!input.employmentMaintenance && input.employeeCount >= 10) {
      return { isEligible: false, reason: 'ê³ ìš© ìœ ì§€ ê³„íš ìˆ˜ë¦½ í•„ìš”' };
    }
    
    return { isEligible: true };
  }

  private static generateManagementPlan(input: BusinessInheritanceInput): {
    period: number;
    employmentCount: number;
    risks: PenaltyRisk[];
  } {
    const managementPeriod = 10; // 10ë…„ê°„ ì‚¬í›„ê´€ë¦¬
    const employmentCount = Math.floor(input.employeeCount * 0.8); // 80% ì´ìƒ ê³ ìš© ìœ ì§€
    
    const risks: PenaltyRisk[] = [
      {
        violationType: 'ê²½ì˜ ì°¸ì—¬ ì˜ë¬´ ìœ„ë°˜',
        penaltyRate: 0.2,
        penaltyAmount: input.businessInheritanceDeduction * 0.2,
        riskLevel: 'high'
      },
      {
        violationType: 'ê³ ìš© ìœ ì§€ ì˜ë¬´ ìœ„ë°˜',
        penaltyRate: 0.1,
        penaltyAmount: input.businessInheritanceDeduction * 0.1,
        riskLevel: 'medium'
      },
      {
        violationType: 'ì‚¬ì—…ì¥ ì´ì „',
        penaltyRate: 0.15,
        penaltyAmount: input.businessInheritanceDeduction * 0.15,
        riskLevel: 'low'
      }
    ];
    
    return { period: managementPeriod, employmentCount, risks };
  }
}
```

---

## ğŸ“ˆ ì£¼ì‹ì´ë™ ì„¸ê¸ˆ í†µí•© ê³„ì‚°ê¸° ì„¤ê³„

### ê¸°ëŠ¥ ê°œìš”
- ì£¼ì‹ì˜ ì´ë™ ë°©ì‹(ì–‘ë„/ì¦ì—¬/ìƒì†/ë°°ë‹¹)ì— ë”°ë¥¸ ì„¸ê¸ˆ í†µí•© ê³„ì‚°
- ìƒì¥/ë¹„ìƒì¥, ëŒ€ì£¼ì£¼/ì†Œì•¡ì£¼ì£¼ êµ¬ë¶„ ìë™ íŒë³„
- ìµœì  ì´ë™ ë°©ì‹ ì„¸ê¸ˆ ë¹„êµ ë° ì¶”ì²œ

### ê³µí†µ ì…ë ¥ ì¸í„°í˜ì´ìŠ¤
```typescript
interface StockTransferInput extends TaxCalculationInput {
  // ì£¼ì‹ ê¸°ë³¸ ì •ë³´
  stockType: 'listed' | 'unlisted';     // ìƒì¥/ë¹„ìƒì¥
  companyName: string;                  // íšŒì‚¬ëª…
  stockQuantity: number;                // ì£¼ì‹ ìˆ˜ëŸ‰
  pricePerShare: number;                // ì£¼ë‹¹ ê°€ê²©
  totalValue: number;                   // ì´ ê°€ì•¡
  
  // ë³´ìœ  í˜„í™©
  holdingPeriod: number;                // ë³´ìœ ê¸°ê°„ (ì›”ë‹¨ìœ„)
  acquisitionPrice: number;             // ì·¨ë“ê°€ì•¡
  acquisitionDate: Date;                // ì·¨ë“ì¼ì
  
  // ì§€ë¶„ ì •ë³´
  totalSharesOutstanding: number;       // ì´ ë°œí–‰ì£¼ì‹ìˆ˜
  shareholdingRatio: number;            // ì§€ë¶„ìœ¨
  isLargestShareholder: boolean;        // ëŒ€ì£¼ì£¼ ì—¬ë¶€
  familyShareholdingRatio: number;      // íŠ¹ìˆ˜ê´€ê³„ì¸ í¬í•¨ ì§€ë¶„ìœ¨
  
  // ì´ë™ ì •ë³´
  transferType: 'sale' | 'gift' | 'inheritance' | 'dividend'; // ì´ë™ ìœ í˜•
  transferPrice?: number;               // ì–‘ë„ê°€ì•¡ (ë§¤ë§¤ì‹œ)
  transferDate: Date;                   // ì´ë™ì¼ì
  
  // ë‹¹ì‚¬ì ì •ë³´
  transferorAge?: number;               // ì–‘ë„ì ë‚˜ì´
  transfereeAge?: number;               // ì–‘ìˆ˜ì ë‚˜ì´
  relationship?: string;                // ì–‘ë„ì-ì–‘ìˆ˜ì ê´€ê³„
  transfereeResidence: 'domestic' | 'foreign'; // ì–‘ìˆ˜ì ê±°ì£¼ì§€
  
  // ì„¸ë¬´ ì •ë³´
  hasOtherCapitalGains: boolean;        // ê¸°íƒ€ ì–‘ë„ì†Œë“ ì¡´ì¬ ì—¬ë¶€
  previousGiftHistory: GiftHistory[];   // ì´ì „ ì¦ì—¬ ì´ë ¥
  taxExemptionApplicable: boolean;      // ë¹„ê³¼ì„¸ ì ìš© ê°€ëŠ¥ ì—¬ë¶€
}

interface GiftHistory {
  date: Date;
  amount: number;
  relationship: string;
  giftType: string;
}
```

### ì£¼ì‹ì–‘ë„ì†Œë“ì„¸ ê³„ì‚° ë¡œì§
```typescript
class StockCapitalGainsTaxCalculator {
  static calculate(input: StockTransferInput): StockTransferResult {
    // 1ë‹¨ê³„: ëŒ€ì£¼ì£¼ ì—¬ë¶€ íŒì •
    const isLargeShareholder = this.determineLargeShareholderStatus(input);
    
    // 2ë‹¨ê³„: ê³¼ì„¸ ëŒ€ìƒ ì—¬ë¶€ í™•ì¸
    const isTaxable = this.checkTaxability(input, isLargeShareholder);
    
    if (!isTaxable) {
      return this.generateNonTaxableResult(input);
    }
    
    // 3ë‹¨ê³„: ì–‘ë„ì°¨ìµ ê³„ì‚°
    const capitalGain = input.transferPrice! - input.acquisitionPrice;
    
    // 4ë‹¨ê³„: ì–‘ë„ì†Œë“ì„¸ ê³„ì‚°
    let taxRate: number;
    if (input.stockType === 'listed') {
      // ìƒì¥ì£¼ì‹
      taxRate = isLargeShareholder ? this.getListedLargeShareholderRate(input.holdingPeriod) : 0;
    } else {
      // ë¹„ìƒì¥ì£¼ì‹
      taxRate = this.getUnlistedStockTaxRate(input.holdingPeriod, isLargeShareholder);
    }
    
    const calculatedTax = Math.floor(Math.max(0, capitalGain) * taxRate);
    const localIncomeTax = Math.floor(calculatedTax * 0.1);
    const totalTax = calculatedTax + localIncomeTax;
    
    // 5ë‹¨ê³„: ì„¸ë¶€ ê³„ì‚° ë‚´ì—­ ìƒì„±
    const breakdown = this.generateStockTransferBreakdown(input, capitalGain, calculatedTax);
    
    return {
      transferType: 'sale',
      capitalGain,
      taxableAmount: Math.max(0, capitalGain),
      calculatedTax,
      localIncomeTax,
      totalTax,
      netProceeds: input.transferPrice! - totalTax,
      isLargeShareholder,
      appliedTaxRate: taxRate,
      breakdown,
      appliedRates: [{ range: `${taxRate * 100}%`, rate: taxRate, amount: calculatedTax }],
      deductions: []
    };
  }

  private static determineLargeShareholderStatus(input: StockTransferInput): boolean {
    // ëŒ€ì£¼ì£¼ íŒì • ê¸°ì¤€
    const shareholdingThreshold = input.stockType === 'listed' ? 0.01 : 0.04; // ìƒì¥ 1%, ë¹„ìƒì¥ 4%
    const valueThreshold = input.stockType === 'listed' ? 10000000000 : 10000000000; // 100ì–µì›
    
    return (
      input.shareholdingRatio >= shareholdingThreshold ||
      input.totalValue >= valueThreshold ||
      input.familyShareholdingRatio >= shareholdingThreshold
    );
  }

  private static checkTaxability(input: StockTransferInput, isLargeShareholder: boolean): boolean {
    // ìƒì¥ì£¼ì‹ ì†Œì•¡ì£¼ì£¼ëŠ” ëŒ€ë¶€ë¶„ ë¹„ê³¼ì„¸
    if (input.stockType === 'listed' && !isLargeShareholder) {
      return false;
    }
    
    // ë¹„ìƒì¥ì£¼ì‹ì€ ëŒ€ë¶€ë¶„ ê³¼ì„¸
    return true;
  }

  private static getListedLargeShareholderRate(holdingPeriod: number): number {
    if (holdingPeriod < 12) return 0.30; // 1ë…„ ë¯¸ë§Œ: 30%
    if (holdingPeriod < 24) return 0.25; // 1ë…„~2ë…„: 25%
    return 0.20; // 2ë…„ ì´ìƒ: 20%
  }

  private static getUnlistedStockTaxRate(holdingPeriod: number, isLargeShareholder: boolean): number {
    const baseRate = isLargeShareholder ? 0.25 : 0.20;
    
    if (holdingPeriod < 12) return baseRate + 0.10; // ë‹¨ê¸°ë³´ìœ  ê°€ì‚°ì„¸
    return baseRate;
  }
}
```

### ì£¼ì‹ì¦ì—¬ì„¸ ê³„ì‚° ë¡œì§
```typescript
class StockGiftTaxCalculator {
  static calculate(input: StockTransferInput): StockTransferResult {
    // 1ë‹¨ê³„: ì¦ì—¬ì¬ì‚° ê°€ì•¡ í‰ê°€
    const giftValue = this.evaluateStockValue(input);
    
    // 2ë‹¨ê³„: ì¦ì—¬ê³µì œ ê³„ì‚°
    const giftDeduction = this.calculateGiftDeduction(input);
    
    // 3ë‹¨ê³„: ê³¼ì„¸í‘œì¤€ ê³„ì‚°
    const taxableAmount = Math.max(0, giftValue - giftDeduction);
    
    // 4ë‹¨ê³„: ì¦ì—¬ì„¸ ê³„ì‚°
    const calculatedTax = this.calculateProgressiveTax(taxableAmount, GIFT_TAX_RATES);
    const localIncomeTax = Math.floor(calculatedTax * 0.1);
    const totalTax = calculatedTax + localIncomeTax;
    
    // 5ë‹¨ê³„: í• ì¦/ê°ë©´ ì ìš©
    const adjustedTax = this.applyAdjustments(totalTax, input);
    
    return {
      transferType: 'gift',
      giftValue,
      giftDeduction,
      taxableAmount,
      calculatedTax: adjustedTax.tax,
      localIncomeTax: Math.floor(adjustedTax.tax * 0.1),
      totalTax: adjustedTax.totalTax,
      surchargeRate: adjustedTax.surchargeRate,
      breakdown: this.generateGiftTaxBreakdown(input, giftValue, adjustedTax.tax),
      appliedRates: this.getGiftTaxRates(taxableAmount),
      deductions: [
        { type: 'gift', label: 'ì¦ì—¬ê³µì œ', amount: giftDeduction }
      ]
    };
  }

  private static evaluateStockValue(input: StockTransferInput): number {
    if (input.stockType === 'listed') {
      // ìƒì¥ì£¼ì‹: í‰ê°€ê¸°ì¤€ì¼ ì „í›„ 2ê°œì›” í‰ê· ê°€ì•¡
      return input.totalValue;
    } else {
      // ë¹„ìƒì¥ì£¼ì‹: ìˆœì†ìµê°€ì¹˜ì™€ ìˆœìì‚°ê°€ì¹˜ì˜ ê°€ì¤‘í‰ê· 
      // ì‹¤ì œë¡œëŠ” ë” ë³µì¡í•œ í‰ê°€ ë°©ë²• ì ìš©
      return input.totalValue;
    }
  }

  private static calculateGiftDeduction(input: StockTransferInput): number {
    const deductionLimits: Record<string, number> = {
      'spouse': 600000000,      // ë°°ìš°ì: 6ì–µ
      'lineal_descendant': 50000000, // ì§ê³„ë¹„ì†: 5ì²œë§Œì›
      'lineal_ascendant': 50000000,  // ì§ê³„ì¡´ì†: 5ì²œë§Œì›
      'sibling': 10000000,      // í˜•ì œìë§¤: 1ì²œë§Œì›
      'other': 10000000         // ê¸°íƒ€: 1ì²œë§Œì›
    };
    
    const relationshipKey = this.mapRelationshipKey(input.relationship || 'other');
    return deductionLimits[relationshipKey] || 10000000;
  }

  private static applyAdjustments(baseTax: number, input: StockTransferInput): {
    tax: number;
    totalTax: number;
    surchargeRate: number;
  } {
    let adjustedTax = baseTax;
    let surchargeRate = 0;
    
    // ë¹„ìƒì¥ì£¼ì‹ í• ì¦ì„¸ìœ¨ ì ìš©
    if (input.stockType === 'unlisted' && input.isLargestShareholder) {
      surchargeRate = 0.30; // 30% í• ì¦
      adjustedTax = baseTax * (1 + surchargeRate);
    }
    
    // ì¬ì™¸êµ­ë¯¼ ì¦ì—¬ì„¸ ê°ë©´ ë“± ê¸°íƒ€ ì¡°ì •ì‚¬í•­ ì ìš©
    // ...
    
    const totalTax = adjustedTax + Math.floor(adjustedTax * 0.1);
    
    return { tax: adjustedTax, totalTax, surchargeRate };
  }
}
```

### ì£¼ì‹ë°°ë‹¹ì†Œë“ì„¸ ê³„ì‚° ë¡œì§
```typescript
class StockDividendTaxCalculator {
  static calculate(input: DividendInput): DividendTaxResult {
    // 1ë‹¨ê³„: ë°°ë‹¹ì†Œë“ êµ¬ë¶„
    const dividendType = this.classifyDividend(input);
    
    // 2ë‹¨ê³„: ì›ì²œì§•ìˆ˜ì„¸ìœ¨ ê²°ì •
    const withholdingRate = this.getWithholdingRate(dividendType, input.transfereeResidence);
    
    // 3ë‹¨ê³„: ì›ì²œì§•ìˆ˜ì„¸ì•¡ ê³„ì‚°
    const withholdingTax = Math.floor(input.dividendAmount * withholdingRate);
    const localIncomeTax = Math.floor(withholdingTax * 0.1);
    const totalWithholdingTax = withholdingTax + localIncomeTax;
    
    // 4ë‹¨ê³„: ì¢…í•©ì†Œë“ ì‹ ê³  ì‹œ ì¶”ê°€/í™˜ê¸‰ì„¸ì•¡ ê³„ì‚°
    const comprehensiveResult = this.calculateComprehensiveTax(input);
    
    return {
      dividendAmount: input.dividendAmount,
      dividendType,
      withholdingRate,
      withholdingTax,
      localIncomeTax,
      totalWithholdingTax,
      netDividend: input.dividendAmount - totalWithholdingTax,
      comprehensiveInclusion: comprehensiveResult.shouldInclude,
      additionalTax: comprehensiveResult.additionalTax,
      refundAmount: comprehensiveResult.refundAmount,
      finalNetDividend: comprehensiveResult.finalNetAmount
    };
  }

  private static getWithholdingRate(dividendType: string, residence: string): number {
    if (residence === 'foreign') {
      return 0.22; // ë¹„ê±°ì£¼ì: 22%
    }
    
    switch (dividendType) {
      case 'general': return 0.14;    // ì¼ë°˜ë°°ë‹¹: 14%
      case 'small_company': return 0.09; // ì†Œê¸°ì—…ë°°ë‹¹: 9%
      default: return 0.14;
    }
  }
}
```

### í†µí•© ë¹„êµ ë¶„ì„ ê¸°ëŠ¥
```typescript
class StockTransferComparisonCalculator {
  static compareAllMethods(input: StockTransferInput): TransferMethodComparison {
    const saleResult = StockCapitalGainsTaxCalculator.calculate({
      ...input,
      transferType: 'sale'
    });
    
    const giftResult = StockGiftTaxCalculator.calculate({
      ...input,
      transferType: 'gift'
    });
    
    // ê° ë°©ë²•ë³„ ì„¸ë¶€ë‹´ ë° ìˆœìˆ˜ì·¨ì•¡ ë¹„êµ
    const comparison: TransferMethodComparison = {
      sale: {
        totalTax: saleResult.totalTax,
        netAmount: saleResult.netProceeds,
        effectiveRate: (saleResult.totalTax / input.totalValue) * 100
      },
      gift: {
        totalTax: giftResult.totalTax,
        netAmount: input.totalValue - giftResult.totalTax,
        effectiveRate: (giftResult.totalTax / input.totalValue) * 100
      },
      inheritance: {
        // ìƒì† ì‹œë‚˜ë¦¬ì˜¤ ê³„ì‚°
      }
    };
    
    // ìµœì  ë°©ë²• ì¶”ì²œ
    const recommendation = this.recommendOptimalMethod(comparison, input);
    
    return {
      ...comparison,
      recommendation
    };
  }

  private static recommendOptimalMethod(
    comparison: TransferMethodComparison,
    input: StockTransferInput
  ): TransferRecommendation {
    // ì„¸ë¶€ë‹´ ìµœì†Œí™” ê´€ì ì—ì„œ ìµœì  ë°©ë²• ì„ íƒ
    const methods = Object.entries(comparison);
    const optimal = methods.reduce((min, current) => 
      current[1].totalTax < min[1].totalTax ? current : min
    );
    
    return {
      recommendedMethod: optimal[0] as TransferMethod,
      reason: `ì„¸ë¶€ë‹´ ìµœì†Œí™” (ì„¸ì•¡: ${optimal[1].totalTax.toLocaleString()}ì›)`,
      taxSaving: Math.max(...methods.map(m => m[1].totalTax)) - optimal[1].totalTax,
      considerations: this.generateConsiderations(input, optimal[0] as TransferMethod)
    };
  }
}
```

### UI ì»´í¬ë„ŒíŠ¸ ì¶”ê°€ ì„¤ê³„

#### íƒ­ êµ¬ì¡° í™•ì¥
```typescript
// ê¸°ì¡´ íƒ­ì— ì¶”ê°€
const extendedTabs: TabItem[] = [
  // ... ê¸°ì¡´ íƒ­ë“¤
  {
    key: 'special',
    label: 'íŠ¹í™”ê³„ì‚°',
    icon: <StarOutlined />,
    children: <SpecialTaxCalculators />
  }
];

// íŠ¹í™”ê³„ì‚° íƒ­ í•˜ìœ„ ë©”ë‰´
const specialCalculators = [
  {
    key: 'business-inheritance',
    label: 'ê°€ì—…ìƒì†ì„¸',
    component: <BusinessInheritanceCalculator />
  },
  {
    key: 'stock-transfer',
    label: 'ì£¼ì‹ì´ë™ì„¸ê¸ˆ',
    component: <StockTransferCalculator />
  }
];
```

#### ì£¼ì‹ì´ë™ ê³„ì‚°ê¸° UI ì„¤ê³„
```typescript
interface StockTransferCalculatorProps {
  onCalculate: (result: StockTransferResult) => void;
}

const StockTransferCalculator: React.FC<StockTransferCalculatorProps> = ({ onCalculate }) => {
  const [transferType, setTransferType] = useState<TransferType>('sale');
  const [inputs, setInputs] = useState<StockTransferInput>({});
  const [comparisonMode, setComparisonMode] = useState(false);

  return (
    <div className="stock-transfer-calculator">
      {/* ê³„ì‚° ë°©ì‹ ì„ íƒ */}
      <Card title="ì´ë™ ë°©ì‹ ì„ íƒ">
        <Radio.Group value={transferType} onChange={(e) => setTransferType(e.target.value)}>
          <Radio.Button value="sale">ì–‘ë„ (ë§¤ë§¤)</Radio.Button>
          <Radio.Button value="gift">ì¦ì—¬</Radio.Button>
          <Radio.Button value="inheritance">ìƒì†</Radio.Button>
          <Radio.Button value="dividend">ë°°ë‹¹</Radio.Button>
        </Radio.Group>
        
        <Switch 
          checked={comparisonMode}
          onChange={setComparisonMode}
          checkedChildren="ë¹„êµëª¨ë“œ"
          unCheckedChildren="ë‹¨ì¼ê³„ì‚°"
        />
      </Card>

      {/* ì£¼ì‹ ì •ë³´ ì…ë ¥ */}
      <Card title="ì£¼ì‹ ì •ë³´">
        <Row gutter={16}>
          <Col span={12}>
            <NumberInput
              label="ì£¼ì‹ ìˆ˜ëŸ‰"
              value={inputs.stockQuantity}
              onChange={(value) => setInputs({...inputs, stockQuantity: value})}
              suffix="ì£¼"
              required
            />
          </Col>
          <Col span={12}>
            <NumberInput
              label="ì£¼ë‹¹ ê°€ê²©"
              value={inputs.pricePerShare}
              onChange={(value) => setInputs({...inputs, pricePerShare: value})}
              suffix="ì›"
              required
            />
          </Col>
        </Row>
        
        <Select
          placeholder="ìƒì¥/ë¹„ìƒì¥ êµ¬ë¶„"
          value={inputs.stockType}
          onChange={(value) => setInputs({...inputs, stockType: value})}
        >
          <Option value="listed">ìƒì¥ì£¼ì‹</Option>
          <Option value="unlisted">ë¹„ìƒì¥ì£¼ì‹</Option>
        </Select>
      </Card>

      {/* ì¡°ê±´ë¶€ ì…ë ¥ í•„ë“œ */}
      {transferType === 'sale' && (
        <Card title="ì–‘ë„ ì •ë³´">
          <NumberInput
            label="ì–‘ë„ê°€ì•¡"
            value={inputs.transferPrice}
            onChange={(value) => setInputs({...inputs, transferPrice: value})}
            required
          />
          <DatePicker
            label="ì–‘ë„ì¼ì"
            value={inputs.transferDate}
            onChange={(date) => setInputs({...inputs, transferDate: date})}
          />
        </Card>
      )}

      {transferType === 'gift' && (
        <Card title="ì¦ì—¬ ì •ë³´">
          <Select
            label="ìˆ˜ì¦ìì™€ì˜ ê´€ê³„"
            value={inputs.relationship}
            onChange={(value) => setInputs({...inputs, relationship: value})}
          >
            <Option value="spouse">ë°°ìš°ì</Option>
            <Option value="lineal_descendant">ì§ê³„ë¹„ì†</Option>
            <Option value="lineal_ascendant">ì§ê³„ì¡´ì†</Option>
            <Option value="sibling">í˜•ì œìë§¤</Option>
            <Option value="other">ê¸°íƒ€</Option>
          </Select>
        </Card>
      )}

      {/* ê²°ê³¼ í‘œì‹œ ì˜ì—­ */}
      {comparisonMode ? (
        <StockTransferComparison inputs={inputs} />
      ) : (
        <StockTransferResult 
          transferType={transferType}
          inputs={inputs}
        />
      )}
    </div>
  );
};
```

---

## ğŸ“Š ë°ì´í„° êµ¬ì¡° í™•ì¥

### ì¶”ê°€ ì„¸ìœ¨ ë°ì´í„°
```json
// taxRates.json í™•ì¥
{
  "businessInheritance": {
    "maxDeduction": {
      "small": 30000000000,
      "medium": 50000000000
    },
    "deductionRates": {
      "under3years": 0.8,
      "3to7years": 0.9,
      "over7years": 1.0
    },
    "penaltyRates": {
      "managementViolation": 0.2,
      "employmentViolation": 0.1,
      "locationViolation": 0.15
    }
  },
  "stockTransfer": {
    "capitalGainsTax": {
      "listed": {
        "largeShareholder": {
          "under1year": 0.30,
          "1to2years": 0.25,
          "over2years": 0.20
        },
        "smallShareholder": 0.0
      },
      "unlisted": {
        "largeShareholder": {
          "under1year": 0.35,
          "over1year": 0.25
        },
        "smallShareholder": {
          "under1year": 0.30,
          "over1year": 0.20
        }
      }
    },
    "giftTax": {
      "surchargeRates": {
        "unlistedLargeShareholder": 0.30
      },
      "deductionLimits": {
        "spouse": 600000000,
        "lineal_descendant": 50000000,
        "lineal_ascendant": 50000000,
        "sibling": 10000000,
        "other": 10000000
      }
    },
    "dividendTax": {
      "withholding": {
        "domestic": {
          "general": 0.14,
          "smallCompany": 0.09
        },
        "foreign": 0.22
      }
    }
  }
}
```

### ê³„ì‚° íˆìŠ¤í† ë¦¬ í™•ì¥
```typescript
interface ExtendedCalculationRecord extends CalculationRecord {
  // ê°€ì—…ìƒì† ê´€ë ¨
  businessInheritanceDetails?: {
    businessType: string;
    deductionAmount: number;
    taxSavingAmount: number;
    managementPeriod: number;
  };
  
  // ì£¼ì‹ì´ë™ ê´€ë ¨
  stockTransferDetails?: {
    transferType: string;
    stockType: string;
    isLargeShareholder: boolean;
    comparisonResults?: TransferMethodComparison;
    recommendedMethod?: string;
  };
}
```

---

## ğŸ§ª ì¶”ê°€ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

### ê°€ì—…ìƒì†ì„¸ í…ŒìŠ¤íŠ¸
```typescript
describe('BusinessInheritanceCalculator', () => {
  test('ì¤‘ì†Œê¸°ì—… ê°€ì—…ìƒì†ê³µì œ ê³„ì‚°', () => {
    const input: BusinessInheritanceInput = {
      totalInheritanceValue: 10000000000,
      businessAssetValue: 8000000000,
      businessType: 'small',
      businessPeriod: 10,
      employeeCount: 50,
      continuousManagement: true,
      employmentMaintenance: true
    };

    const result = BusinessInheritanceCalculator.calculate(input);

    expect(result.businessInheritanceDeduction).toBe(8000000000); // 80ì–µ ì „ì•¡ ê³µì œ
    expect(result.taxSavingAmount).toBeGreaterThan(1000000000); // 10ì–µ ì´ìƒ ì ˆì„¸
  });
});

describe('StockCapitalGainsTaxCalculator', () => {
  test('ìƒì¥ì£¼ì‹ ëŒ€ì£¼ì£¼ ì–‘ë„ì†Œë“ì„¸', () => {
    const input: StockTransferInput = {
      stockType: 'listed',
      shareholdingRatio: 0.02, // 2%
      holdingPeriod: 36, // 3ë…„
      acquisitionPrice: 1000000000,
      transferPrice: 1500000000
    };

    const result = StockCapitalGainsTaxCalculator.calculate(input);

    expect(result.isLargeShareholder).toBe(true);
    expect(result.appliedTaxRate).toBe(0.20); // 2ë…„ ì´ìƒ ë³´ìœ 
    expect(result.calculatedTax).toBe(100000000); // 5ì–µì°¨ìµ Ã— 20%
  });
});
```

---

ì´ ì¶”ê°€ ì„¤ê³„ë¥¼ í†µí•´ ì„¸ë¬´ì‚¬ë“¤ì´ ìì£¼ ì ‘í•˜ëŠ” ê°€ì—…ìƒì†ê³¼ ì£¼ì‹ì´ë™ ê´€ë ¨ ë³µì¡í•œ ì„¸ë¬´ ê³„ì‚°ì„ ì •í™•í•˜ê³  ì‹ ì†í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì „ë¬¸ ë„êµ¬ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ê³„ì‚°ê¸°ëŠ” í•´ë‹¹ ë¶„ì•¼ì˜ ì „ë¬¸ì„±ì„ ë°˜ì˜í•˜ì—¬ ì‹¤ë¬´ì—ì„œ ì¦‰ì‹œ í™œìš© ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.