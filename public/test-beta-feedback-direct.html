<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë² íƒ€ í”¼ë“œë°± ì´ë©”ì¼ í…ŒìŠ¤íŠ¸ - ì§ì ‘ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2563eb; text-align: center; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #374151; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
        textarea { height: 120px; resize: vertical; }
        button { background: #2563eb; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        button:hover { background: #1d4ed8; }
        .result { margin-top: 20px; padding: 15px; border-radius: 6px; white-space: pre-wrap; }
        .success { background: #dcfce7; border: 1px solid #16a34a; color: #166534; }
        .error { background: #fee2e2; border: 1px solid #dc2626; color: #991b1b; }
        .info { background: #dbeafe; border: 1px solid #2563eb; color: #1e40af; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ë² íƒ€ í”¼ë“œë°± ì´ë©”ì¼ ë°œì†¡ ì§ì ‘ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸</h3>
            <button onclick="checkSystemStatus()">ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸</button>
            <div id="systemStatus"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“§ ë² íƒ€ í”¼ë“œë°± ì´ë©”ì¼ í…ŒìŠ¤íŠ¸</h3>
            <form id="betaFeedbackForm">
                <div class="form-group">
                    <label for="calculator">ê³„ì‚°ê¸°ëª…:</label>
                    <select id="calculator" required>
                        <option value="ìƒì†ì„¸ ê³„ì‚°ê¸°">ìƒì†ì„¸ ê³„ì‚°ê¸°</option>
                        <option value="ì¦ì—¬ì„¸ ê³„ì‚°ê¸°">ì¦ì—¬ì„¸ ê³„ì‚°ê¸°</option>
                        <option value="ë²•ì¸ì„¸ ê³„ì‚°ê¸°">ë²•ì¸ì„¸ ê³„ì‚°ê¸°</option>
                        <option value="ì¢…í•©ì†Œë“ì„¸ ê³„ì‚°ê¸°">ì¢…í•©ì†Œë“ì„¸ ê³„ì‚°ê¸°</option>
                        <option value="ë¶€ê°€ê°€ì¹˜ì„¸ ê³„ì‚°ê¸°">ë¶€ê°€ê°€ì¹˜ì„¸ ê³„ì‚°ê¸°</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="feedbackType">í”¼ë“œë°± ìœ í˜•:</label>
                    <select id="feedbackType" required>
                        <option value="ğŸ› ë²„ê·¸ ì‹ ê³ ">ğŸ› ë²„ê·¸ ì‹ ê³ </option>
                        <option value="ğŸ’¡ ê°œì„  ì œì•ˆ">ğŸ’¡ ê°œì„  ì œì•ˆ</option>
                        <option value="âœ¨ ê¸°ëŠ¥ ìš”ì²­">âœ¨ ê¸°ëŠ¥ ìš”ì²­</option>
                        <option value="ğŸ’¬ ê¸°íƒ€ ì˜ê²¬">ğŸ’¬ ê¸°íƒ€ ì˜ê²¬</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="userEmail">ì‚¬ìš©ì ì´ë©”ì¼ (ì‹¤ì œ ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥):</label>
                    <input type="email" id="userEmail" required placeholder="ì‹¤ì œë¡œ ì´ë©”ì¼ì„ ë°›ì„ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-group">
                    <label for="problem">ë¬¸ì œ ì„¤ëª…:</label>
                    <textarea id="problem" required placeholder="ë°œìƒí•œ ë¬¸ì œë¥¼ ìƒì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”"></textarea>
                </div>

                <div class="form-group">
                    <label for="expected">ê¸°ëŒ€í•œ ë™ì‘:</label>
                    <textarea id="expected" placeholder="ì–´ë–»ê²Œ ë™ì‘í•´ì•¼ í•œë‹¤ê³  ìƒê°í•˜ì‹œë‚˜ìš”?"></textarea>
                </div>

                <div class="form-group">
                    <label for="actual">ì‹¤ì œ ë™ì‘:</label>
                    <textarea id="actual" placeholder="ì‹¤ì œë¡œëŠ” ì–´ë–»ê²Œ ë™ì‘í–ˆë‚˜ìš”?"></textarea>
                </div>

                <div class="form-group">
                    <label for="steps">ì¬í˜„ ë‹¨ê³„:</label>
                    <textarea id="steps" placeholder="ë¬¸ì œë¥¼ ì¬í˜„í•˜ëŠ” ë‹¨ê³„ë¥¼ ë²ˆí˜¸ë¡œ ë‚˜ì—´í•´ì£¼ì„¸ìš”"></textarea>
                </div>

                <div class="form-group">
                    <label for="severity">ì‹¬ê°ë„:</label>
                    <select id="severity">
                        <option value="ë‚®ìŒ">ë‚®ìŒ</option>
                        <option value="ë³´í†µ">ë³´í†µ</option>
                        <option value="ë†’ìŒ">ë†’ìŒ</option>
                        <option value="ê¸´ê¸‰">ê¸´ê¸‰</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="additional">ì¶”ê°€ ì˜ê²¬:</label>
                    <textarea id="additional" placeholder="ê¸°íƒ€ ì˜ê²¬ì´ë‚˜ ì œì•ˆì‚¬í•­"></textarea>
                </div>

                <button type="submit">ğŸ§ª ë² íƒ€ í”¼ë“œë°± ì œì¶œ (ì´ë©”ì¼ ë°œì†¡ í…ŒìŠ¤íŠ¸)</button>
                <button type="button" onclick="testGoogleScript()">ğŸ”— Google Script ì§ì ‘ í…ŒìŠ¤íŠ¸</button>
            </form>
        </div>

        <div id="result"></div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzE4eVxGetKDK4bLGsF5r3KlkJHJOEgWg-fFYpCi8MzXqKQfojCw4_hSl8gSe5xJcMg/exec';

        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }

        async function checkSystemStatus() {
            try {
                showResult('ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
                
                const response = await fetch(`${API_BASE}/api/beta-feedback`);
                const data = await response.json();
                
                document.getElementById('systemStatus').innerHTML = `
                    <div class="result success">
                        âœ… ì‹œìŠ¤í…œ ìƒíƒœ: ${data.data.status}
                        
                        ğŸ“Š êµ¬ê¸€ì‹œíŠ¸ ì—°ë™: ${data.data.googleSheets.configured ? 'âœ… ì„¤ì •ë¨' : 'âŒ ë¯¸ì„¤ì •'}
                        ğŸ”— ìŠ¤í¬ë¦½íŠ¸ URL: ${data.data.googleSheets.scriptUrl}
                        
                        ğŸ› ï¸ ì§€ì› ê¸°ëŠ¥:
                        ${data.data.features.join('\n')}
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('systemStatus').innerHTML = `
                    <div class="result error">âŒ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${error.message}</div>
                `;
            }
        }

        async function testGoogleScript() {
            try {
                showResult('Google Apps Script ì§ì ‘ í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
                
                const testData = {
                    action: 'saveBetaFeedback',
                    í¼íƒ€ì…: 'ë² íƒ€í…ŒìŠ¤íŠ¸_í”¼ë“œë°±',
                    ê³„ì‚°ê¸°ëª…: 'í…ŒìŠ¤íŠ¸ ê³„ì‚°ê¸°',
                    í”¼ë“œë°±ìœ í˜•: 'ğŸ› ë²„ê·¸ ì‹ ê³ ',
                    ì‚¬ìš©ìì´ë©”ì¼: document.getElementById('userEmail').value || 'test@example.com',
                    ë¬¸ì œì„¤ëª…: 'ì´ë©”ì¼ ë°œì†¡ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤',
                    ë¸Œë¼ìš°ì €ì •ë³´: navigator.userAgent,
                    ì œì¶œê²½ë¡œ: window.location.href
                };

                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                showResult(`âœ… Google Script ì§ì ‘ í…ŒìŠ¤íŠ¸ ì„±ê³µ!\n\nì‘ë‹µ: ${JSON.stringify(result, null, 2)}`, 'success');
                
            } catch (error) {
                showResult(`âŒ Google Script ì§ì ‘ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        document.getElementById('betaFeedbackForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                showResult('ë² íƒ€ í”¼ë“œë°± ì œì¶œ ì¤‘...', 'info');
                
                const formData = {
                    action: 'saveBetaFeedback',
                    ê³„ì‚°ê¸°ëª…: document.getElementById('calculator').value,
                    í”¼ë“œë°±ìœ í˜•: document.getElementById('feedbackType').value,
                    ì‚¬ìš©ìì´ë©”ì¼: document.getElementById('userEmail').value,
                    ë¬¸ì œì„¤ëª…: document.getElementById('problem').value,
                    ê¸°ëŒ€ë™ì‘: document.getElementById('expected').value,
                    ì‹¤ì œë™ì‘: document.getElementById('actual').value,
                    ì¬í˜„ë‹¨ê³„: document.getElementById('steps').value,
                    ì‹¬ê°ë„: document.getElementById('severity').value,
                    ì¶”ê°€ì˜ê²¬: document.getElementById('additional').value,
                    ë¸Œë¼ìš°ì €ì •ë³´: navigator.userAgent,
                    ì œì¶œê²½ë¡œ: window.location.href,
                    í¼íƒ€ì…: 'ë² íƒ€í…ŒìŠ¤íŠ¸_í”¼ë“œë°±',
                    ì œì¶œì¼ì‹œ: new Date().toISOString(),
                    íƒ€ì„ìŠ¤íƒ¬í”„: Date.now(),
                    dataSource: 'direct-test'
                };

                console.log('ğŸ“ ì œì¶œí•  ë°ì´í„°:', formData);

                const response = await fetch(`${API_BASE}/api/beta-feedback`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult(`âœ… ë² íƒ€ í”¼ë“œë°± ì œì¶œ ì„±ê³µ!\n\n${result.message}\n\nğŸ“§ ì´ë©”ì¼ ë°œì†¡ ìƒíƒœ:\n- ê´€ë¦¬ì ì•Œë¦¼: ${result.data.emails?.adminNotified || 'í™•ì¸ ì¤‘'}\n- ì ‘ìˆ˜ í™•ì¸: ${result.data.emails?.userConfirmed || 'í™•ì¸ ì¤‘'}\n\nì‘ë‹µ ë°ì´í„°:\n${JSON.stringify(result, null, 2)}`, 'success');
                } else {
                    showResult(`âŒ ë² íƒ€ í”¼ë“œë°± ì œì¶œ ì‹¤íŒ¨:\n${result.error}\n\nì„¸ë¶€ì‚¬í•­:\n${result.details || 'ì—†ìŒ'}`, 'error');
                }
                
            } catch (error) {
                showResult(`âŒ ë² íƒ€ í”¼ë“œë°± ì œì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œìŠ¤í…œ ìƒíƒœ ìë™ í™•ì¸
        window.addEventListener('load', checkSystemStatus);
    </script>
</body>
</html> 