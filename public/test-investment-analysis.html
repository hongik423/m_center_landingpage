<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ì±…ìê¸ˆ íˆ¬ìë¶„ì„ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }
        .result-box {
            margin: 10px 0;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e5e7eb;
        }
        .result-box.success {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        .result-box.warning {
            border-color: #f59e0b;
            background-color: #fffbeb;
        }
        .result-box.error {
            border-color: #ef4444;
            background-color: #fef2f2;
        }
        .metric {
            display: inline-block;
            margin: 5px 10px;
            padding: 8px 15px;
            background: #3b82f6;
            color: white;
            border-radius: 5px;
            font-weight: bold;
        }
        .metric.secondary {
            background: #6b7280;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #e5e7eb;
            padding: 8px;
            text-align: right;
        }
        th {
            background: #f3f4f6;
            font-weight: bold;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .cashflow-table {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ì •ì±…ìê¸ˆ íˆ¬ìë¶„ì„ ë„êµ¬ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h2>ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤</h2>
            <button onclick="runBasicTest()">ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button onclick="runEdgeCaseTest()">ê·¹í•œ ìƒí™© í…ŒìŠ¤íŠ¸</button>
            <button onclick="runAccuracyTest()">ì •í™•ë„ ê²€ì¦ í…ŒìŠ¤íŠ¸</button>
            <div id="basic-results"></div>
        </div>

        <div class="test-section">
            <h2>í˜„ê¸ˆíë¦„ ë¶„ì„</h2>
            <div id="cashflow-analysis"></div>
        </div>

        <div class="test-section">
            <h2>íšŒìˆ˜ê¸°ê°„ ìƒì„¸ ë¶„ì„</h2>
            <div id="payback-analysis"></div>
        </div>
    </div>

    <script>
        // íˆ¬ìë¶„ì„ í•µì‹¬ í•¨ìˆ˜ë“¤
        function calculateNPV(cashFlows, discountRate) {
            const rate = discountRate / 100;
            return cashFlows.reduce((npv, cashFlow, year) => {
                if (year === 0) return npv + cashFlow;
                return npv + cashFlow / Math.pow(1 + rate, year);
            }, 0);
        }

        function calculateIRR(cashFlows, initialGuess = 10) {
            const maxIterations = 100;
            const tolerance = 0.00001;
            let rate = initialGuess / 100;
            
            for (let i = 0; i < maxIterations; i++) {
                let npv = 0;
                let dnpv = 0;
                
                for (let j = 0; j < cashFlows.length; j++) {
                    const pv = cashFlows[j] / Math.pow(1 + rate, j);
                    npv += pv;
                    if (j > 0) {
                        dnpv -= j * pv / (1 + rate);
                    }
                }
                
                if (Math.abs(npv) < tolerance) {
                    return rate * 100;
                }
                
                if (Math.abs(dnpv) < tolerance) break;
                
                const newRate = rate - npv / dnpv;
                
                if (Math.abs(newRate - rate) < tolerance) {
                    return newRate * 100;
                }
                
                rate = Math.max(-0.99, Math.min(10, newRate));
            }
            
            return rate * 100;
        }

        function calculateSimplePaybackPeriod(cashFlows) {
            let cumulative = 0;
            
            for (let i = 0; i < cashFlows.length; i++) {
                cumulative += cashFlows[i].netCashFlow;
                
                if (cumulative >= 0) {
                    if (i === 0) return cashFlows[0].year;
                    
                    const previousCumulative = cumulative - cashFlows[i].netCashFlow;
                    const fraction = -previousCumulative / cashFlows[i].netCashFlow;
                    return cashFlows[i - 1].year + fraction;
                }
            }
            
            return -1;
        }

        // ê°œì •ëœ í• ì¸íšŒìˆ˜ê¸°ê°„ ê³„ì‚° (ì •ì±…ìê¸ˆ íŠ¹ì„± ë°˜ì˜)
        function calculateDiscountedPaybackPeriod(
            cashFlows, 
            totalInitialInvestment, 
            policyFundAmount = 0, 
            discountRate = 10
        ) {
            console.log('\nğŸ” ê°œì •ëœ í• ì¸íšŒìˆ˜ê¸°ê°„ ê³„ì‚°');
            console.log(`ì´ íˆ¬ìê¸ˆì•¡: ${formatMoney(totalInitialInvestment)}`);
            console.log(`ì •ì±…ìê¸ˆ: ${formatMoney(policyFundAmount)}`);
            console.log(`ì‹¤ì œ íˆ¬ìê¸ˆì•¡: ${formatMoney(totalInitialInvestment - policyFundAmount)}`);
            
            const rate = discountRate / 100;
            
            // ì •ì±…ìê¸ˆì˜ í˜„ì¬ê°€ì¹˜ ê³„ì‚° (ìƒí™˜ìŠ¤ì¼€ì¤„ ê³ ë ¤)
            let policyFundPV = 0;
            if (policyFundAmount > 0) {
                // ì •ì±…ìê¸ˆ ìƒí™˜ì•¡ì˜ í˜„ì¬ê°€ì¹˜ ê³„ì‚° (ê°„ì†Œí™”)
                // ì‹¤ì œë¡œëŠ” ì´ììœ¨ì´ ë‹¤ë¥´ì§€ë§Œ, í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í• ì¸ìœ¨ ì‚¬ìš©
                const totalPayments = policyFundAmount * 1.1; // 10% ì´ì ê°€ì •
                const avgYears = 3; // í‰ê·  ìƒí™˜ê¸°ê°„ ê°€ì •
                const discountedPayments = totalPayments / Math.pow(1 + rate, avgYears);
                
                policyFundPV = policyFundAmount - discountedPayments;
                console.log(`ì •ì±…ìê¸ˆ ìˆœí˜„ì¬ê°€ì¹˜: ${formatMoney(policyFundPV)}`);
            }
            
            // ê°œì •ëœ ì´ˆê¸° íˆ¬ì ê¸°ì¤€ì 
            const adjustedInitialInvestment = totalInitialInvestment - policyFundPV;
            console.log(`ê°œì •ëœ ì´ˆê¸°íˆ¬ì ê¸°ì¤€: ${formatMoney(adjustedInitialInvestment)}`);
            
            // ëˆ„ì  í˜„ì¬ê°€ì¹˜ ì¬ê³„ì‚°
            let cumulativePV = -adjustedInitialInvestment;
            
            for (let i = 0; i < cashFlows.length; i++) {
                const cf = cashFlows[i];
                cumulativePV += cf.presentValue;
                
                console.log(`${cf.year}ë…„: ëˆ„ì PV = ${formatMoney(cumulativePV)}`);
                
                if (cumulativePV >= 0) {
                    if (i === 0) return cf.year;
                    
                    const previousPV = cumulativePV - cf.presentValue;
                    const currentPV = cumulativePV;
                    
                    if (previousPV < 0 && currentPV >= 0) {
                        const fraction = -previousPV / (currentPV - previousPV);
                        const paybackPeriod = cashFlows[i - 1].year + fraction;
                        console.log(`ê°œì •ëœ íšŒìˆ˜ê¸°ê°„: ${paybackPeriod.toFixed(3)}ë…„`);
                        return paybackPeriod;
                    }
                    
                    return cf.year;
                }
            }
            
            return -1;
        }

        function performSimpleAnalysis(input) {
            const actualInvestment = input.initialInvestment - input.policyFundAmount;
            const cashFlows = [];
            const netCashFlows = [-actualInvestment];
            
            let cumulativeCashFlow = -actualInvestment;
            let cumulativePV = -actualInvestment;
            
            // ì´ˆê¸° íˆ¬ì
            cashFlows.push({
                year: 0,
                netCashFlow: -actualInvestment,
                cumulativeCashFlow: -actualInvestment,
                presentValue: -actualInvestment,
                cumulativePV: -actualInvestment
            });
            
            // ì—°ë„ë³„ í˜„ê¸ˆíë¦„
            for (let year = 1; year <= input.analysisYears; year++) {
                const revenue = input.annualRevenue[year - 1] || input.annualRevenue[0];
                const operatingProfit = revenue * (input.operatingProfitRate / 100);
                const tax = operatingProfit * (input.taxRate / 100);
                const netIncome = operatingProfit - tax;
                
                // ê°„ì†Œí™”ëœ í˜„ê¸ˆíë¦„ (ëŒ€ì¶œ ìƒí™˜ ì œì™¸)
                const netCashFlow = netIncome;
                
                cumulativeCashFlow += netCashFlow;
                
                const presentValue = netCashFlow / Math.pow(1 + input.discountRate / 100, year);
                cumulativePV += presentValue;
                
                cashFlows.push({
                    year,
                    revenue,
                    operatingProfit,
                    netIncome,
                    netCashFlow,
                    cumulativeCashFlow,
                    presentValue,
                    cumulativePV
                });
                
                netCashFlows.push(netCashFlow);
            }
            
            const npv = calculateNPV(netCashFlows, input.discountRate);
            const irr = calculateIRR(netCashFlows);
            const simplePayback = calculateSimplePaybackPeriod(cashFlows.slice(1));
            const discountedPayback = calculateDiscountedPaybackPeriod(
                cashFlows, 
                input.initialInvestment, 
                input.policyFundAmount || 0, 
                input.discountRate
            );
            
            return {
                npv,
                irr,
                simplePayback,
                discountedPayback,
                cashFlows,
                netCashFlows
            };
        }

        function formatMoney(amount) {
            return (amount / 100000000).toFixed(2) + 'ì–µì›';
        }

        function runBasicTest() {
            const testCase = {
                initialInvestment: 10000000000, // 100ì–µ
                policyFundAmount: 5000000000,   // 50ì–µ
                annualRevenue: [8000000000, 10000000000, 12000000000, 14000000000, 16000000000],
                operatingProfitRate: 20,
                taxRate: 22,
                discountRate: 10,
                analysisYears: 5
            };
            
            const result = performSimpleAnalysis(testCase);
            
            let html = '<h3>ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼</h3>';
            html += '<div class="result-box success">';
            html += '<h4>íˆ¬ì ì¡°ê±´</h4>';
            html += `<p>ì´ˆê¸° íˆ¬ì: ${formatMoney(testCase.initialInvestment)}</p>`;
            html += `<p>ì •ì±…ìê¸ˆ: ${formatMoney(testCase.policyFundAmount)}</p>`;
            html += `<p>ì‹¤ì œ íˆ¬ì: ${formatMoney(testCase.initialInvestment - testCase.policyFundAmount)}</p>`;
            html += `<p>ì˜ì—…ì´ìµë¥ : ${testCase.operatingProfitRate}%</p>`;
            html += `<p>í• ì¸ìœ¨: ${testCase.discountRate}%</p>`;
            html += '</div>';
            
            html += '<div class="result-box">';
            html += '<h4>ë¶„ì„ ê²°ê³¼</h4>';
            html += `<span class="metric">NPV: ${formatMoney(result.npv)}</span>`;
            html += `<span class="metric">IRR: ${result.irr.toFixed(2)}%</span>`;
            html += `<span class="metric secondary">ê°œì • í• ì¸íšŒìˆ˜ê¸°ê°„: ${result.discountedPayback > 0 ? result.discountedPayback.toFixed(2) + 'ë…„' : 'ë¯¸íšŒìˆ˜'}</span>`;
            html += '</div>';
            
            // í˜„ê¸ˆíë¦„ í…Œì´ë¸”
            html += '<div class="cashflow-table">';
            html += '<table>';
            html += '<tr><th>ì—°ë„</th><th>ë§¤ì¶œ</th><th>ì˜ì—…ì´ìµ</th><th>ìˆœì´ìµ</th><th>í˜„ê¸ˆíë¦„</th><th>ëˆ„ì í˜„ê¸ˆíë¦„</th><th>í˜„ì¬ê°€ì¹˜</th><th>ëˆ„ì í˜„ì¬ê°€ì¹˜</th></tr>';
            
            result.cashFlows.forEach(cf => {
                const rowClass = cf.cumulativeCashFlow >= 0 ? 'style="background-color: #f0fdf4;"' : '';
                html += `<tr ${rowClass}>`;
                html += `<td>${cf.year}</td>`;
                html += `<td>${cf.revenue ? formatMoney(cf.revenue) : '-'}</td>`;
                html += `<td>${cf.operatingProfit ? formatMoney(cf.operatingProfit) : '-'}</td>`;
                html += `<td>${cf.netIncome ? formatMoney(cf.netIncome) : '-'}</td>`;
                html += `<td>${formatMoney(cf.netCashFlow)}</td>`;
                html += `<td>${formatMoney(cf.cumulativeCashFlow)}</td>`;
                html += `<td>${formatMoney(cf.presentValue)}</td>`;
                html += `<td>${formatMoney(cf.cumulativePV)}</td>`;
                html += '</tr>';
            });
            
            html += '</table>';
            html += '</div>';
            
            document.getElementById('basic-results').innerHTML = html;
            
            // í• ì¸ íšŒìˆ˜ê¸°ê°„ ìƒì„¸ ë¶„ì„
            analyzeDiscountedPaybackPeriod(result);
        }

        function analyzeDiscountedPaybackPeriod(result) {
            let html = '<h3>ê°œì •ëœ í• ì¸ íšŒìˆ˜ê¸°ê°„ ìƒì„¸ ë¶„ì„</h3>';
            
            html += '<div class="result-box">';
            html += '<h4>ê°œì •ëœ í• ì¸ íšŒìˆ˜ê¸°ê°„ ê³„ì‚° ì›ë¦¬</h4>';
            html += '<p><strong>ê¸°ì¡´ ë°©ì‹:</strong> ì‹¤ì œíˆ¬ìê¸ˆì•¡(ì´íˆ¬ì-ì •ì±…ìê¸ˆ) ê¸°ì¤€</p>';
            html += '<p><strong>ê°œì • ë°©ì‹:</strong> ì •ì±…ìê¸ˆì„ ë¶€ì±„ë¡œ ì¸ì‹í•œ ì´íˆ¬ìê¸ˆì•¡ ê¸°ì¤€</p>';
            html += '<p><strong>ê°œì • ê³µì‹:</strong> -ì¡°ì •ëœì´ˆê¸°íˆ¬ì + PVâ‚ + PVâ‚‚ + ... + PVâ‚™ = 0</p>';
            html += '<p><strong>ì¡°ì •ëœì´ˆê¸°íˆ¬ì:</strong> ì´íˆ¬ìê¸ˆì•¡ - ì •ì±…ìê¸ˆìˆœí˜„ì¬ê°€ì¹˜</p>';
            html += '<p><strong>ì •ì±…ìê¸ˆìˆœí˜„ì¬ê°€ì¹˜:</strong> ì •ì±…ìê¸ˆ - ìƒí™˜ì•¡í˜„ì¬ê°€ì¹˜</p>';
            html += '<p><strong>ì¥ì :</strong> ì •ì±…ìê¸ˆì˜ ì‹¤ì§ˆì  í˜œíƒì„ ì •í™•íˆ ë°˜ì˜</p>';
            html += '</div>';
            
            // í• ì¸ íšŒìˆ˜ê¸°ê°„ ë¶„ì„
            html += '<div class="result-box">';
            html += '<h4>í• ì¸ íšŒìˆ˜ê¸°ê°„ ê³„ì‚° ê²°ê³¼</h4>';
            
            const discountedPaybackYear = Math.floor(result.discountedPayback);
            const discountedPaybackFraction = result.discountedPayback - discountedPaybackYear;
            
            if (result.discountedPayback > 0) {
                html += `<p><strong>íšŒìˆ˜ ì™„ë£Œ:</strong> ${discountedPaybackYear}ë…„ + ${(discountedPaybackFraction * 12).toFixed(0)}ê°œì›”</p>`;
                html += `<p><strong>ì •í™•í•œ ê¸°ê°„:</strong> ${result.discountedPayback.toFixed(3)}ë…„</p>`;
                
                const relevantCashFlows = result.cashFlows.filter(cf => cf.year <= discountedPaybackYear + 1);
                html += '<table>';
                html += '<tr><th>ì—°ë„</th><th>í˜„ê¸ˆíë¦„</th><th>í˜„ì¬ê°€ì¹˜</th><th>ëˆ„ì í˜„ì¬ê°€ì¹˜</th><th>ìƒíƒœ</th></tr>';
                relevantCashFlows.forEach(cf => {
                    const status = cf.cumulativePV >= 0 ? 'âœ… íšŒìˆ˜ì™„ë£Œ' : 'âŒ ë¯¸íšŒìˆ˜';
                    const statusColor = cf.cumulativePV >= 0 ? 'style="background-color: #f0fdf4;"' : '';
                    html += `<tr ${statusColor}>`;
                    html += `<td>${cf.year}ë…„</td>`;
                    html += `<td>${formatMoney(cf.netCashFlow)}</td>`;
                    html += `<td>${formatMoney(cf.presentValue)}</td>`;
                    html += `<td>${formatMoney(cf.cumulativePV)}</td>`;
                    html += `<td>${status}</td>`;
                    html += '</tr>';
                });
                html += '</table>';
                
                // íšŒìˆ˜ ê³¼ì • ì„¤ëª…
                html += '<h5>íšŒìˆ˜ ê³¼ì • ë¶„ì„</h5>';
                const breakEvenCF = relevantCashFlows.find(cf => cf.cumulativePV >= 0);
                if (breakEvenCF && breakEvenCF.year > 1) {
                    const prevCF = relevantCashFlows[breakEvenCF.year - 2];
                    if (prevCF) {
                        html += `<p>â€¢ ${prevCF.year}ë…„ ë§: ëˆ„ì PV ${formatMoney(prevCF.cumulativePV)} (ì•„ì§ ë¯¸íšŒìˆ˜)</p>`;
                        html += `<p>â€¢ ${breakEvenCF.year}ë…„ ë§: ëˆ„ì PV ${formatMoney(breakEvenCF.cumulativePV)} (íšŒìˆ˜ì™„ë£Œ)</p>`;
                        html += `<p>â€¢ ë”°ë¼ì„œ ${prevCF.year}ë…„ê³¼ ${breakEvenCF.year}ë…„ ì‚¬ì´ì— íˆ¬ìê¸ˆ íšŒìˆ˜</p>`;
                    }
                }
            } else {
                html += '<p class="error"><strong>ê²°ê³¼:</strong> ë¶„ì„ ê¸°ê°„ ë‚´ íˆ¬ìê¸ˆ íšŒìˆ˜ ë¶ˆê°€ëŠ¥</p>';
                html += '<p>ëˆ„ì í˜„ì¬ê°€ì¹˜ê°€ ì–‘ìˆ˜ê°€ ë˜ì§€ ì•ŠìŒ â†’ íˆ¬ì ë¶€ì í•©</p>';
            }
            html += '</div>';
            
            // ê°œì •ìˆ˜ì‹ íš¨ê³¼ ë¶„ì„
            html += '<div class="result-box warning">';
            html += '<h4>ê°œì •ìˆ˜ì‹ íš¨ê³¼ ë¶„ì„</h4>';
            html += `<p><strong>ì ìš© í• ì¸ìœ¨:</strong> 10%</p>`;
            html += '<p><strong>ê°œì •ìˆ˜ì‹ì˜ ì¥ì :</strong></p>';
            html += '<ul>';
            html += '<li>ì •ì±…ìê¸ˆì„ ë¶€ì±„ë¡œ ì •í™•íˆ ì¸ì‹</li>';
            html += '<li>ìƒí™˜ìŠ¤ì¼€ì¤„ì˜ í˜„ì¬ê°€ì¹˜ ë°˜ì˜</li>';
            html += '<li>ì´íˆ¬ìê¸ˆì•¡ ê¸°ì¤€ì˜ ì¼ê´€ëœ ë¶„ì„</li>';
            html += '<li>ì •ì±…ìê¸ˆ í˜œíƒì˜ ì •ëŸ‰ì  ì¸¡ì •</li>';
            html += '</ul>';
            
            if (result.discountedPayback > 0) {
                html += `<p><strong>ê°œì •íš¨ê³¼:</strong> ì •ì±…ìê¸ˆì˜ ì‹¤ì§ˆì  í˜œíƒì´ íšŒìˆ˜ê¸°ê°„ì— ë°˜ì˜ë¨</p>`;
                html += `<p><strong>ì˜ë¯¸:</strong> ê¸°ì¡´ ë°©ì‹ë³´ë‹¤ ë” ì •í™•í•œ íˆ¬ì íƒ€ë‹¹ì„± í‰ê°€</p>`;
            }
            html += '</div>';
            
            document.getElementById('payback-analysis').innerHTML = html;
        }

        function runAccuracyTest() {
            const simpleCase = {
                initialInvestment: 1000000000, // 10ì–µ
                policyFundAmount: 0,
                annualRevenue: [500000000, 500000000, 500000000], // ë§¤ë…„ 5ì–µ
                operatingProfitRate: 40, // 40%
                taxRate: 0, // ë‹¨ìˆœí™”ë¥¼ ìœ„í•´ ì„¸ê¸ˆ ì—†ìŒ
                discountRate: 10,
                analysisYears: 3
            };
            
            const result = performSimpleAnalysis(simpleCase);
            
            // ìˆ˜ë™ ê³„ì‚°
            const annualCashFlow = 200000000; // 5ì–µ * 40% = 2ì–µ
            const manualNPV = -1000000000 + 
                              annualCashFlow / 1.1 + 
                              annualCashFlow / (1.1 * 1.1) + 
                              annualCashFlow / (1.1 * 1.1 * 1.1);
            
            let html = '<h3>ì •í™•ë„ ê²€ì¦ ê²°ê³¼</h3>';
            html += '<div class="result-box">';
            html += '<h4>NPV ê²€ì¦</h4>';
            html += `<p>ì‹œìŠ¤í…œ ê³„ì‚°: ${formatMoney(result.npv)}</p>`;
            html += `<p>ìˆ˜ë™ ê³„ì‚°: ${formatMoney(manualNPV)}</p>`;
            html += `<p>ì°¨ì´: ${formatMoney(Math.abs(result.npv - manualNPV))}</p>`;
            
            const npvAccurate = Math.abs(result.npv - manualNPV) < 1000000;
            html += `<p>ì •í™•ë„: ${npvAccurate ? 'âœ… ì •í™•' : 'âŒ ì˜¤ë¥˜'}</p>`;
            html += '</div>';
            
            // IRR ê²€ì¦
            html += '<div class="result-box">';
            html += '<h4>IRR ê²€ì¦</h4>';
            html += `<p>ê³„ì‚°ëœ IRR: ${result.irr.toFixed(4)}%</p>`;
            
            // IRRë¡œ NPV ì¬ê³„ì‚°
            const irrRate = result.irr / 100;
            const npvAtIRR = -1000000000 + 
                             annualCashFlow / (1 + irrRate) + 
                             annualCashFlow / Math.pow(1 + irrRate, 2) + 
                             annualCashFlow / Math.pow(1 + irrRate, 3);
            
            html += `<p>IRRì—ì„œì˜ NPV: ${formatMoney(npvAtIRR)}</p>`;
            const irrAccurate = Math.abs(npvAtIRR) < 1000000;
            html += `<p>ì •í™•ë„: ${irrAccurate ? 'âœ… ì •í™• (NPV â‰ˆ 0)' : 'âŒ ì˜¤ë¥˜'}</p>`;
            html += '</div>';
            
            document.getElementById('basic-results').innerHTML = html;
        }

        function runEdgeCaseTest() {
            const edgeCases = [
                {
                    name: 'ì†ì‹¤ í”„ë¡œì íŠ¸',
                    input: {
                        initialInvestment: 10000000000,
                        policyFundAmount: 0,
                        annualRevenue: [1000000000, 1000000000, 1000000000],
                        operatingProfitRate: 5,
                        taxRate: 22,
                        discountRate: 10,
                        analysisYears: 3
                    }
                },
                {
                    name: 'ë†’ì€ í• ì¸ìœ¨',
                    input: {
                        initialInvestment: 10000000000,
                        policyFundAmount: 5000000000,
                        annualRevenue: [8000000000, 10000000000, 12000000000],
                        operatingProfitRate: 20,
                        taxRate: 22,
                        discountRate: 50,
                        analysisYears: 3
                    }
                },
                {
                    name: 'ìŒì˜ ì˜ì—…ì´ìµë¥ ',
                    input: {
                        initialInvestment: 5000000000,
                        policyFundAmount: 2000000000,
                        annualRevenue: [3000000000, 3000000000, 3000000000],
                        operatingProfitRate: -10,
                        taxRate: 22,
                        discountRate: 10,
                        analysisYears: 3
                    }
                }
            ];
            
            let html = '<h3>ê·¹í•œ ìƒí™© í…ŒìŠ¤íŠ¸</h3>';
            
            edgeCases.forEach(testCase => {
                const result = performSimpleAnalysis(testCase.input);
                
                const resultClass = result.npv > 0 ? 'success' : 'error';
                html += `<div class="result-box ${resultClass}">`;
                html += `<h4>${testCase.name}</h4>`;
                html += `<p>ì˜ì—…ì´ìµë¥ : ${testCase.input.operatingProfitRate}%, í• ì¸ìœ¨: ${testCase.input.discountRate}%</p>`;
                html += `<span class="metric">NPV: ${formatMoney(result.npv)}</span>`;
                html += `<span class="metric">IRR: ${result.irr.toFixed(2)}%</span>`;
                html += `<span class="metric secondary">ê°œì • í• ì¸íšŒìˆ˜ê¸°ê°„: ${result.discountedPayback > 0 ? result.discountedPayback.toFixed(2) + 'ë…„' : 'ë¯¸íšŒìˆ˜'}</span>`;
                html += '</div>';
            });
            
            document.getElementById('basic-results').innerHTML = html;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.onload = function() {
            runBasicTest();
        };
    </script>
</body>
</html> 