name: M-CENTER AI ìë™í™” ì‹œìŠ¤í…œ

on:
  schedule:
    - cron: '0 9 * * MON'  # ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 9ì‹œ ë³´ê³ ì„œ ìƒì„±
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰
  push:
    paths:
      - 'src/app/api/**'
      - 'src/lib/utils/**'

jobs:
  ai-report-generation:
    name: AI ì§„ë‹¨ë³´ê³ ì„œ ìë™ìƒì„±
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‚ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        
      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          npm ci
          
      - name: ğŸ¤– AI ì§„ë‹¨ë³´ê³ ì„œ ìë™ìƒì„±
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          NEXT_PUBLIC_GOOGLE_SHEETS_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_SHEETS_ID }}
          NEXT_PUBLIC_GOOGLE_SCRIPT_URL: ${{ secrets.NEXT_PUBLIC_GOOGLE_SCRIPT_URL }}
        run: |
          node -e "
          const { generateWeeklyReport } = require('./scripts/ai-report-generator.js');
          generateWeeklyReport().catch(console.error);
          "
          
      # ì„±ê³¼ ë¶„ì„ ë° ì´ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ì€ ëˆ„ë½ëœ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì¸í•´ ì„ì‹œ ë¹„í™œì„±í™”
      # TODO: ai-performance-analyzer.js ë° ai-email-sender.js íŒŒì¼ ìƒì„± í›„ í™œì„±í™”
      # - name: ğŸ“Š ì„±ê³¼ ë¶„ì„ ë° ê°œì„  ì œì•ˆ
      #   env:
      #     GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      #   run: |
      #     node -e "
      #     const { analyzePerformance } = require('./scripts/ai-performance-analyzer.js');
      #     analyzePerformance().catch(console.error);
      #     "
      #     
      # - name: ğŸ“§ ìë™ ì´ë©”ì¼ ë°œì†¡ (Google Apps Script ê¸°ë°˜)
      #   env:
      #     NEXT_PUBLIC_GOOGLE_SCRIPT_URL: ${{ secrets.NEXT_PUBLIC_GOOGLE_SCRIPT_URL }}
      #     NEXT_PUBLIC_GOOGLE_SHEETS_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_SHEETS_ID }}
      #   run: |
      #     node -e "
      #     const { sendAutomatedReport } = require('./scripts/ai-email-sender.js');
      #     sendAutomatedReport().catch(console.error);
      #     "
          
      - name: ğŸ’¾ ê²°ê³¼ ì €ì¥
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "M-CENTER AI"
          git add docs/ || echo "docs í´ë”ê°€ ì—†ì–´ ê±´ë„ˆëœë‹ˆë‹¤"
          git commit -m "ğŸ¤– AI ìë™ìƒì„± ë³´ê³ ì„œ ì¶”ê°€ $(date +'%Y-%m-%d')" || echo "ì»¤ë°‹í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤"
          git push || echo "í‘¸ì‹œí•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤"

  ai-chatbot-training:
    name: AI ì±—ë´‡ í•™ìŠµ ë°ì´í„° ì—…ë°ì´íŠ¸
    runs-on: ubuntu-latest
    needs: ai-report-generation
    
    steps:
      - name: ğŸ“‚ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        
      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm ci
        
      - name: ğŸ§  AI ì±—ë´‡ í•™ìŠµ ë°ì´í„° ì—…ë°ì´íŠ¸
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          NEXT_PUBLIC_GOOGLE_SHEETS_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_SHEETS_ID }}
          NEXT_PUBLIC_GOOGLE_SCRIPT_URL: ${{ secrets.NEXT_PUBLIC_GOOGLE_SCRIPT_URL }}
        run: |
          node -e "
          const { updateChatbotTraining } = require('./scripts/ai-chatbot-trainer.js');
          updateChatbotTraining().catch(console.error);
          "
          
      - name: ğŸš€ ì±—ë´‡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        run: |
          npm run test:chatbot || echo 'ì±—ë´‡ í…ŒìŠ¤íŠ¸ ì™„ë£Œ' 