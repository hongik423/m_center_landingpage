name: M-CENTER AI ìë™í™” ì‹œìŠ¤í…œ

on:
  schedule:
    - cron: '0 9 * * MON'  # ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 9ì‹œ ë³´ê³ ì„œ ìƒì„±
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰
  push:
    paths:
      - 'src/app/api/**'
      - 'src/lib/utils/**'

jobs:
  ai-report-generation:
    name: AI ì§„ë‹¨ë³´ê³ ì„œ ìë™ìƒì„±
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‚ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        
      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          npm ci
          npm install openai
          
      - name: ğŸ¤– AI ì§„ë‹¨ë³´ê³ ì„œ ìë™ìƒì„±
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GOOGLE_SHEETS_API_KEY: ${{ secrets.GOOGLE_SHEETS_API_KEY }}
        run: |
          node -e "
          const { generateWeeklyReport } = require('./scripts/ai-report-generator.js');
          generateWeeklyReport().catch(console.error);
          "
          
      - name: ğŸ“Š ì„±ê³¼ ë¶„ì„ ë° ê°œì„  ì œì•ˆ
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          node -e "
          const { analyzePerformance } = require('./scripts/ai-performance-analyzer.js');
          analyzePerformance().catch(console.error);
          "
          
      - name: ğŸ“§ ìë™ ì´ë©”ì¼ ë°œì†¡
        env:
          EMAILJS_SERVICE_ID: ${{ secrets.EMAILJS_SERVICE_ID }}
          EMAILJS_TEMPLATE_ID: ${{ secrets.EMAILJS_TEMPLATE_ID }}
          EMAILJS_PUBLIC_KEY: ${{ secrets.EMAILJS_PUBLIC_KEY }}
        run: |
          node -e "
          const { sendAutomatedReport } = require('./scripts/ai-email-sender.js');
          sendAutomatedReport().catch(console.error);
          "
          
      - name: ğŸ’¾ ê²°ê³¼ ì €ì¥
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "M-CENTER AI"
          git add reports/
          git commit -m "ğŸ¤– AI ìë™ìƒì„± ë³´ê³ ì„œ ì¶”ê°€ $(date +'%Y-%m-%d')" || exit 0
          git push

  ai-chatbot-training:
    name: AI ì±—ë´‡ í•™ìŠµ ë°ì´í„° ì—…ë°ì´íŠ¸
    runs-on: ubuntu-latest
    needs: ai-report-generation
    
    steps:
      - name: ğŸ“‚ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        
      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm ci
        
      - name: ğŸ§  AI ì±—ë´‡ í•™ìŠµ ë°ì´í„° ì—…ë°ì´íŠ¸
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          node -e "
          const { updateChatbotTraining } = require('./scripts/ai-chatbot-trainer.js');
          updateChatbotTraining().catch(console.error);
          "
          
      - name: ğŸš€ ì±—ë´‡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        run: |
          npm run test:chatbot || echo 'ì±—ë´‡ í…ŒìŠ¤íŠ¸ ì™„ë£Œ' 