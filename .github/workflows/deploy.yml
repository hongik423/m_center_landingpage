name: ğŸš€ M-CENTER ë³„-AIìƒë‹´ì‚¬ ìë™ ë°°í¬

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  Deploy-Production:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: npm ci
      
    - name: ğŸ” Environment Variables Check
      run: |
        echo "ğŸ” í™˜ê²½ë³€ìˆ˜ ê²€ì¦ ì¤‘..."
        echo "âœ… GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY != '' }}"
        echo "âœ… EMAILJS_SERVICE_ID: ${{ secrets.NEXT_PUBLIC_EMAILJS_SERVICE_ID != '' }}"
        echo "âœ… GOOGLE_SHEETS_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_SHEETS_ID != '' }}"
        echo "âœ… NODE_ENV: production"
        
    - name: ğŸ—ï¸ Build Application
      run: |
        npm run build
        touch out/.nojekyll
      env:
        # ğŸ”§ GitHub Pages ì •ì  ë¹Œë“œ í™œì„±í™”
        GITHUB_PAGES: true
        # ğŸ¤– AI ê´€ë ¨ í™˜ê²½ë³€ìˆ˜ (ì„œë²„ ì‚¬ì´ë“œ ì „ìš©)
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        
        # ğŸ“§ EmailJS ê´€ë ¨ í™˜ê²½ë³€ìˆ˜ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í—ˆìš©)
        NEXT_PUBLIC_EMAILJS_SERVICE_ID: ${{ secrets.NEXT_PUBLIC_EMAILJS_SERVICE_ID }}
        NEXT_PUBLIC_EMAILJS_PUBLIC_KEY: ${{ secrets.NEXT_PUBLIC_EMAILJS_PUBLIC_KEY }}
        NEXT_PUBLIC_EMAILJS_TEMPLATE_DIAGNOSIS: ${{ secrets.NEXT_PUBLIC_EMAILJS_TEMPLATE_DIAGNOSIS }}
        NEXT_PUBLIC_EMAILJS_TEMPLATE_CONSULTATION: ${{ secrets.NEXT_PUBLIC_EMAILJS_TEMPLATE_CONSULTATION }}
        NEXT_PUBLIC_EMAILJS_TEMPLATE_ADMIN: ${{ secrets.NEXT_PUBLIC_EMAILJS_TEMPLATE_ADMIN }}
        
        # ğŸ“Š Google Sheets ê´€ë ¨ í™˜ê²½ë³€ìˆ˜ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í—ˆìš©)
        NEXT_PUBLIC_GOOGLE_SHEETS_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_SHEETS_ID }}
        NEXT_PUBLIC_GOOGLE_SCRIPT_URL: ${{ secrets.NEXT_PUBLIC_GOOGLE_SCRIPT_URL }}
        NEXT_PUBLIC_GOOGLE_SCRIPT_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_SCRIPT_ID }}
        NEXT_PUBLIC_GOOGLE_SCRIPT_DEPLOYMENT_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_SCRIPT_DEPLOYMENT_ID }}
        NEXT_PUBLIC_GOOGLE_SHEETS_URL: ${{ secrets.NEXT_PUBLIC_GOOGLE_SHEETS_URL }}
        
        # ğŸŒ ì‚¬ì´íŠ¸ ì„¤ì •
        NEXT_PUBLIC_BASE_URL: ${{ secrets.NEXT_PUBLIC_BASE_URL }}
        ADMIN_EMAIL: ${{ secrets.ADMIN_EMAIL }}
        
        # ğŸ¤– AI ìƒë‹´ì‚¬ ì„¤ì •
        NEXT_PUBLIC_AI_ASSISTANT_NAME: ${{ secrets.NEXT_PUBLIC_AI_ASSISTANT_NAME }}
        NEXT_PUBLIC_AI_ASSISTANT_DESCRIPTION: ${{ secrets.NEXT_PUBLIC_AI_ASSISTANT_DESCRIPTION }}
        
        # ğŸ”§ ì‹œìŠ¤í…œ ì„¤ì •
        NODE_ENV: production
        NOTIFICATION_ENABLED: true
        AUTO_REPLY_ENABLED: true
        
    - name: ğŸ§ª Build Verification
      run: |
        echo "ğŸ§ª ë¹Œë“œ ê²€ì¦ ì¤‘..."
        if [ -d ".next" ]; then
          echo "âœ… Next.js ë¹Œë“œ ì„±ê³µ"
          ls -la .next/
        else
          echo "âŒ Next.js ë¹Œë“œ ì‹¤íŒ¨"
          exit 1
        fi
        if [ -d "out" ]; then
          echo "âœ… ì •ì  íŒŒì¼ ìƒì„± ì„±ê³µ"
          ls -la out/
          echo "ğŸ“„ index.html í™•ì¸:"
          ls -la out/index.html
        else
          echo "âŒ ì •ì  íŒŒì¼ ìƒì„± ì‹¤íŒ¨"
          exit 1
        fi
        
    - name: ğŸ“¤ Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./out
        force_orphan: true
        enable_jekyll: false
        cname: # GitHub Pages ì»¤ìŠ¤í…€ ë„ë©”ì¸ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì…ë ¥
        
    - name: ğŸ” Post-Deploy Health Check
      run: |
        echo "ğŸ” GitHub Pages ë°°í¬ í›„ ìƒíƒœ í™•ì¸ ì¤‘..."
        sleep 30
        echo "âœ… GitHub Pages ë°°í¬ ì™„ë£Œ"
        
    - name: ğŸ“¢ Deployment Success Notification
      if: success()
      run: |
        echo "ğŸ‰ ê¸°ì—…ì˜ë³„ ì›¹ì‚¬ì´íŠ¸ ë°°í¬ ì„±ê³µ!"
        echo "ğŸŒ GitHub Pages: https://hongik423.github.io/m_center_landingpage/"
        echo "ğŸ¨ ìƒˆë¡œìš´ ê³ í’ˆì§ˆ SVG ë¡œê³  ì ìš© ì™„ë£Œ"
        echo "ğŸ“± ëª¨ë°”ì¼ ìµœì í™” ì™„ë£Œ"
        echo "ğŸ”¥ ì„¸ê¸ˆê³„ì‚°ê¸° ìš°ì„  ë°°ì¹˜ ì™„ë£Œ"
        
  Deploy-Preview:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: npm ci
      
    - name: ğŸ—ï¸ Build Application (Preview)
      run: npm run build
      env:
        # ğŸ¤– AI ê´€ë ¨ í™˜ê²½ë³€ìˆ˜
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        
        # ğŸ“§ EmailJS ê´€ë ¨ í™˜ê²½ë³€ìˆ˜
        NEXT_PUBLIC_EMAILJS_SERVICE_ID: ${{ secrets.NEXT_PUBLIC_EMAILJS_SERVICE_ID }}
        NEXT_PUBLIC_EMAILJS_PUBLIC_KEY: ${{ secrets.NEXT_PUBLIC_EMAILJS_PUBLIC_KEY }}
        NEXT_PUBLIC_EMAILJS_TEMPLATE_DIAGNOSIS: ${{ secrets.NEXT_PUBLIC_EMAILJS_TEMPLATE_DIAGNOSIS }}
        NEXT_PUBLIC_EMAILJS_TEMPLATE_CONSULTATION: ${{ secrets.NEXT_PUBLIC_EMAILJS_TEMPLATE_CONSULTATION }}
        NEXT_PUBLIC_EMAILJS_TEMPLATE_ADMIN: ${{ secrets.NEXT_PUBLIC_EMAILJS_TEMPLATE_ADMIN }}
        
        # ğŸ“Š Google Sheets ê´€ë ¨ í™˜ê²½ë³€ìˆ˜
        NEXT_PUBLIC_GOOGLE_SHEETS_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_SHEETS_ID }}
        NEXT_PUBLIC_GOOGLE_SCRIPT_URL: ${{ secrets.NEXT_PUBLIC_GOOGLE_SCRIPT_URL }}
        NEXT_PUBLIC_GOOGLE_SCRIPT_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_SCRIPT_ID }}
        NEXT_PUBLIC_GOOGLE_SCRIPT_DEPLOYMENT_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_SCRIPT_DEPLOYMENT_ID }}
        NEXT_PUBLIC_GOOGLE_SHEETS_URL: ${{ secrets.NEXT_PUBLIC_GOOGLE_SHEETS_URL }}
        
        # ğŸŒ ì‚¬ì´íŠ¸ ì„¤ì •
        NEXT_PUBLIC_BASE_URL: ${{ secrets.NEXT_PUBLIC_BASE_URL }}
        ADMIN_EMAIL: ${{ secrets.ADMIN_EMAIL }}
        
        # ğŸ¤– AI ìƒë‹´ì‚¬ ì„¤ì •
        NEXT_PUBLIC_AI_ASSISTANT_NAME: ${{ secrets.NEXT_PUBLIC_AI_ASSISTANT_NAME }}
        NEXT_PUBLIC_AI_ASSISTANT_DESCRIPTION: ${{ secrets.NEXT_PUBLIC_AI_ASSISTANT_DESCRIPTION }}
        
        # ğŸ”§ ì‹œìŠ¤í…œ ì„¤ì •
        NODE_ENV: production
        NOTIFICATION_ENABLED: true
        AUTO_REPLY_ENABLED: true 